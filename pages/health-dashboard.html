<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Dashboard — Cami</title>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg: #f5f1eb; --card: #faf8f5; --border: #c5d4c9; --border-light: #e8efe6;
            --text: #2c2620; --muted: #6b7a66; --accent: #5a7d64; --accent-hover: #4a6b54;
            --success: #4a7c59; --warning: #b8860b; --danger: #c0392b; --info: #2980b9;
            --sidebar-bg: #faf8f5; --sidebar-width: 240px;
        }
        [data-theme="dark"] {
            --bg: #0f1117; --card: #161822; --border: rgba(90,125,100,0.2); --border-light: rgba(90,125,100,0.1);
            --text: #e4e4e8; --muted: #9a9ba4; --accent: #6e9a7a; --accent-hover: #7eb08a;
            --success: #5a9a6a; --warning: #d4a843; --danger: #e74c3c; --info: #3498db;
            --sidebar-bg: #161822;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; }

        /* Layout */
        .app-layout { display: flex; min-height: 100vh; }
        
        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width); background: var(--sidebar-bg); border-right: 1px solid var(--border);
            position: fixed; top: 0; left: 0; bottom: 0; overflow-y: auto; z-index: 100;
        }
        .sidebar-header { padding: 20px; border-bottom: 1px solid var(--border); }
        .sidebar-logo { font-family: 'Libre Baskerville', Georgia, serif; font-size: 18px; font-weight: 700; color: var(--text); text-decoration: none; }
        .sidebar-logo span { font-weight: 400; font-size: 12px; color: var(--muted); display: block; margin-top: 2px; }
        .sidebar-nav { padding: 16px 12px; }
        .nav-section { margin-bottom: 24px; }
        .nav-section-title { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em; color: var(--muted); padding: 0 12px; margin-bottom: 8px; }
        .nav-item { display: flex; align-items: center; gap: 10px; padding: 10px 12px; border-radius: 8px; color: var(--muted); text-decoration: none; font-size: 14px; font-weight: 500; transition: all 0.15s; cursor: pointer; border: none; background: none; width: 100%; text-align: left; }
        .nav-item:hover { background: var(--border-light); color: var(--text); }
        .nav-item.active { background: rgba(90,125,100,0.1); color: var(--accent); }
        .nav-item .icon { font-size: 18px; width: 24px; text-align: center; }
        .nav-item .badge { margin-left: auto; background: var(--accent); color: #fff; font-size: 10px; font-weight: 700; padding: 2px 6px; border-radius: 10px; }

        /* Main content */
        .main-content { margin-left: var(--sidebar-width); flex: 1; min-height: 100vh; }
        .content-header { padding: 20px 32px; border-bottom: 1px solid var(--border); background: var(--card); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 50; }
        .content-header h1 { font-size: 20px; font-weight: 600; }
        .content-header .actions { display: flex; gap: 12px; }
        .content-body { padding: 32px; }

        /* Cards */
        .card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; margin-bottom: 24px; }
        .card-header { padding: 16px 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .card-header h2 { font-size: 14px; font-weight: 600; }
        .card-body { padding: 20px; }
        .card-footer { padding: 12px 20px; border-top: 1px solid var(--border); background: var(--border-light); border-radius: 0 0 12px 12px; }

        /* Buttons */
        .btn { display: inline-flex; align-items: center; gap: 6px; padding: 10px 18px; border-radius: 8px; font-size: 13px; font-weight: 600; border: none; cursor: pointer; text-decoration: none; transition: all 0.15s; }
        .btn:hover { transform: translateY(-1px); }
        .btn-primary { background: var(--accent); color: #fff; }
        .btn-primary:hover { background: var(--accent-hover); }
        .btn-secondary { background: var(--card); border: 1px solid var(--border); color: var(--text); }
        .btn-secondary:hover { border-color: var(--accent); color: var(--accent); }
        .btn-danger { background: var(--danger); color: #fff; }
        .btn-sm { padding: 6px 12px; font-size: 12px; }
        .btn-icon { width: 36px; height: 36px; padding: 0; justify-content: center; }

        /* Stats grid */
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 32px; }
        .stat-card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 20px; }
        .stat-card .stat-value { font-size: 32px; font-weight: 700; color: var(--accent); margin-bottom: 4px; }
        .stat-card .stat-label { font-size: 13px; color: var(--muted); }
        .stat-card .stat-change { font-size: 12px; margin-top: 8px; }
        .stat-card .stat-change.positive { color: var(--success); }
        .stat-card .stat-change.negative { color: var(--danger); }

        /* Tables */
        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th, .data-table td { padding: 12px 16px; text-align: left; border-bottom: 1px solid var(--border); }
        .data-table th { font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; color: var(--muted); background: var(--border-light); }
        .data-table tr:hover { background: var(--border-light); }

        /* Status badges */
        .badge { display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 600; text-transform: uppercase; }
        .badge-success { background: rgba(39,174,96,0.1); color: var(--success); }
        .badge-warning { background: rgba(243,156,18,0.1); color: var(--warning); }
        .badge-danger { background: rgba(231,76,60,0.1); color: var(--danger); }
        .badge-info { background: rgba(52,152,219,0.1); color: var(--info); }
        .badge-neutral { background: var(--border-light); color: var(--muted); }

        /* Quick actions */
        .quick-actions { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 32px; }
        .quick-action { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 20px; text-align: center; cursor: pointer; transition: all 0.15s; text-decoration: none; color: var(--text); }
        .quick-action:hover { border-color: var(--accent); transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        .quick-action .icon { font-size: 28px; margin-bottom: 12px; }
        .quick-action h4 { font-size: 14px; font-weight: 600; margin-bottom: 4px; }
        .quick-action p { font-size: 12px; color: var(--muted); }

        /* Empty state */
        .empty-state { text-align: center; padding: 60px 24px; color: var(--muted); }
        .empty-state .icon { font-size: 64px; margin-bottom: 16px; opacity: 0.5; }
        .empty-state h3 { font-size: 18px; font-weight: 600; color: var(--text); margin-bottom: 8px; }
        .empty-state p { font-size: 14px; margin-bottom: 20px; }

        /* Loading */
        .loading { display: flex; align-items: center; justify-content: center; padding: 40px; color: var(--muted); }
        .spinner { width: 24px; height: 24px; border: 2px solid var(--border); border-top-color: var(--accent); border-radius: 50%; animation: spin 0.8s linear infinite; margin-right: 12px; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Session item */
        .session-item { display: flex; align-items: center; gap: 16px; padding: 16px; border-bottom: 1px solid var(--border); }
        .session-item:last-child { border-bottom: none; }
        .session-item:hover { background: var(--border-light); }
        .session-icon { width: 44px; height: 44px; background: var(--border-light); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .session-info { flex: 1; }
        .session-info h4 { font-size: 14px; font-weight: 600; margin-bottom: 4px; }
        .session-info .meta { font-size: 12px; color: var(--muted); }
        .session-actions { display: flex; gap: 8px; }

        /* Modal */
        .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 1000; display: none; align-items: center; justify-content: center; }
        .modal-backdrop.active { display: flex; }
        .modal { background: var(--card); border-radius: 16px; max-width: 560px; width: 90%; max-height: 90vh; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.2); }
        .modal-header { padding: 20px 24px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .modal-header h3 { font-size: 18px; font-weight: 600; }
        .modal-body { padding: 24px; max-height: 60vh; overflow-y: auto; }
        .modal-footer { padding: 16px 24px; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 12px; }

        /* Form */
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-size: 13px; font-weight: 600; color: var(--text); margin-bottom: 8px; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 10px 14px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px; background: var(--bg); color: var(--text); }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: var(--accent); }
        .form-group textarea { min-height: 100px; resize: vertical; }
        .form-hint { font-size: 12px; color: var(--muted); margin-top: 6px; }

        /* Integration card */
        .integration-card { display: flex; align-items: center; gap: 16px; padding: 20px; border: 1px solid var(--border); border-radius: 12px; margin-bottom: 12px; }
        .integration-card .logo { width: 48px; height: 48px; background: var(--border-light); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 16px; }
        .integration-card .info { flex: 1; }
        .integration-card .info h4 { font-size: 16px; font-weight: 600; margin-bottom: 4px; }
        .integration-card .info p { font-size: 13px; color: var(--muted); }

        /* Risk indicator */
        .risk-indicator { display: flex; align-items: center; gap: 8px; }
        .risk-dot { width: 8px; height: 8px; border-radius: 50%; }
        .risk-dot.low { background: var(--success); }
        .risk-dot.medium { background: var(--warning); }
        .risk-dot.high { background: var(--danger); }

        /* HIPAA notice */
        .hipaa-notice { background: rgba(90,125,100,0.08); border: 1px solid rgba(90,125,100,0.2); border-radius: 8px; padding: 12px 16px; font-size: 12px; color: var(--muted); margin-bottom: 24px; }
        .hipaa-notice strong { color: var(--text); }

        /* Responsive */
        @media (max-width: 1024px) {
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .quick-actions { grid-template-columns: repeat(2, 1fr); }
        }
        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); }
            .sidebar.open { transform: translateX(0); }
            .main-content { margin-left: 0; }
            .stats-grid, .quick-actions { grid-template-columns: 1fr; }
        }
    </style>
    <script>(function(){try{var t=localStorage.getItem('cami-theme');if(t==='dark')document.documentElement.setAttribute('data-theme','dark');}catch(_){}})();</script>
</head>
<body>
    <div class="app-layout">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/" class="sidebar-logo">Cami <span>Health</span></a>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Overview</div>
                    <button class="nav-item active" data-page="dashboard">
                        <span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="9" rx="1"/><rect x="14" y="3" width="7" height="5" rx="1"/><rect x="14" y="12" width="7" height="9" rx="1"/><rect x="3" y="16" width="7" height="5" rx="1"/></svg></span> Dashboard
                    </button>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Clinical</div>
                    <button class="nav-item" data-page="sessions">
                        <span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg></span> Sessions
                    </button>
                    <button class="nav-item" data-page="notes">
                        <span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg></span> Clinical Notes
                    </button>
                    <button class="nav-item" data-page="patients">
                        <span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg></span> Patients
                    </button>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Tools</div>
                    <button class="nav-item" data-page="differential">
                        <span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg></span> Differential Dx
                    </button>
                    <button class="nav-item" data-page="interactions">
                        <span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m10.5 20.5 10-10a4.95 4.95 0 1 0-7-7l-10 10a4.95 4.95 0 1 0 7 7Z"/><path d="m8.5 8.5 7 7"/></svg></span> Drug Interactions
                    </button>
                    <button class="nav-item" data-page="labs">
                        <span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.5 2v6.5a1 1 0 0 0 1 1h3.5"/><path d="M4.5 6.5V4a2 2 0 0 1 2-2h8.586a1 1 0 0 1 .707.293l4.414 4.414a1 1 0 0 1 .293.707V20a2 2 0 0 1-2 2h-12a2 2 0 0 1-2-2V8"/><path d="M8 18v-6"/><path d="M12 18v-3"/></svg></span> Lab Interpretation
                    </button>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Settings</div>
                    <button class="nav-item" data-page="integrations">
                        <span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg></span> Integrations
                    </button>
                    <button class="nav-item" data-page="settings">
                        <span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg></span> Settings
                    </button>
                </div>
            </nav>
        </aside>

        <!-- Main content -->
        <main class="main-content">
            <!-- Dashboard Page -->
            <div id="page-dashboard" class="page active">
                <header class="content-header">
                    <h1>Dashboard</h1>
                    <div class="actions">
                        <button class="btn btn-secondary btn-sm" onclick="location.href='/app?mode=health'"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:-2px;margin-right:4px"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>Chat</button>
                        <button class="btn btn-primary btn-sm" onclick="showNewSessionModal()"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:-1px"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg> New Session</button>
                    </div>
                </header>
                <div class="content-body">
                    <div class="hipaa-notice">
                        <strong>HIPAA Compliant:</strong> All data is encrypted. No PHI is stored in logs. Audio is deleted after transcription.
                    </div>

                    <!-- Stats -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="stat-sessions">0</div>
                            <div class="stat-label">Sessions This Week</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="stat-notes">0</div>
                            <div class="stat-label">Notes Generated</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="stat-patients">0</div>
                            <div class="stat-label">Active Patients</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="stat-time">0h</div>
                            <div class="stat-label">Time Saved</div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <h2 style="font-size: 14px; font-weight: 600; margin-bottom: 16px;">Quick Actions</h2>
                    <div class="quick-actions">
                        <a href="#" class="quick-action" onclick="showNewSessionModal(); return false;">
                            <div class="icon"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="22"/></svg></div>
                            <h4>Record Session</h4>
                            <p>Start scribe + auto notes</p>
                        </a>
                        <a href="#" class="quick-action" onclick="navigateTo('differential'); return false;">
                            <div class="icon"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg></div>
                            <h4>Differential Diagnosis</h4>
                            <p>Symptom analysis</p>
                        </a>
                        <a href="#" class="quick-action" onclick="navigateTo('interactions'); return false;">
                            <div class="icon"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="m10.5 20.5 10-10a4.95 4.95 0 1 0-7-7l-10 10a4.95 4.95 0 1 0 7 7Z"/><path d="m8.5 8.5 7 7"/></svg></div>
                            <h4>Drug Interactions</h4>
                            <p>Check medications</p>
                        </a>
                        <a href="#" class="quick-action" onclick="navigateTo('labs'); return false;">
                            <div class="icon"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M14.5 2v6.5a1 1 0 0 0 1 1h3.5"/><path d="M4.5 6.5V4a2 2 0 0 1 2-2h8.586a1 1 0 0 1 .707.293l4.414 4.414a1 1 0 0 1 .293.707V20a2 2 0 0 1-2 2h-12a2 2 0 0 1-2-2V8"/><path d="M8 18v-6"/><path d="M12 18v-3"/></svg></div>
                            <h4>Lab Interpretation</h4>
                            <p>Analyze results</p>
                        </a>
                    </div>

                    <!-- Recent Sessions -->
                    <div class="card">
                        <div class="card-header">
                            <h2>Recent Sessions</h2>
                            <button class="btn btn-secondary btn-sm" onclick="navigateTo('sessions')">View All</button>
                        </div>
                        <div class="card-body" id="recent-sessions">
                            <div class="empty-state">
                                <div class="icon"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg></div>
                                <h3>No sessions yet</h3>
                                <p>Start your first session to begin transcribing and generating notes</p>
                                <button class="btn btn-primary" onclick="showNewSessionModal()">Start Session</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sessions Page -->
            <div id="page-sessions" class="page" style="display:none;">
                <header class="content-header">
                    <h1>Sessions</h1>
                    <div class="actions">
                        <button class="btn btn-primary btn-sm" onclick="showNewSessionModal()"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:-1px"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg> New Session</button>
                    </div>
                </header>
                <div class="content-body">
                    <div class="card">
                        <div class="card-header">
                            <h2>All Sessions</h2>
                        </div>
                        <div class="card-body" id="sessions-list">
                            <div class="empty-state">
                                <div class="icon"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg></div>
                                <h3>No sessions recorded</h3>
                                <p>Sessions are transcribed live and notes are auto-generated</p>
                                <button class="btn btn-primary" onclick="showNewSessionModal()">Start Session</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Clinical Notes Page -->
            <div id="page-notes" class="page" style="display:none;">
                <header class="content-header">
                    <h1>Clinical Notes</h1>
                    <div class="actions">
                        <select class="btn btn-secondary btn-sm" id="note-format">
                            <option value="soap">SOAP</option>
                            <option value="dap">DAP</option>
                            <option value="birp">BIRP</option>
                            <option value="progress">Progress</option>
                        </select>
                    </div>
                </header>
                <div class="content-body">
                    <div class="card">
                        <div class="card-header">
                            <h2>Generated Notes</h2>
                        </div>
                        <div class="card-body" id="notes-list">
                            <div class="empty-state">
                                <div class="icon"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg></div>
                                <h3>No notes generated</h3>
                                <p>Notes are automatically created after each session</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Patients Page -->
            <div id="page-patients" class="page" style="display:none;">
                <header class="content-header">
                    <h1>Patients</h1>
                    <div class="actions">
                        <button class="btn btn-primary btn-sm" onclick="showNewPatientModal()"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:-1px"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg> Add Patient</button>
                    </div>
                </header>
                <div class="content-body">
                    <div class="card">
                        <div class="card-header">
                            <h2>Patient List</h2>
                        </div>
                        <div class="card-body" id="patients-list">
                            <div class="empty-state">
                                <div class="icon"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg></div>
                                <h3>No patients added</h3>
                                <p>Add patients to track sessions and progress over time</p>
                                <button class="btn btn-primary" onclick="showNewPatientModal()">Add Patient</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Differential Diagnosis Page -->
            <div id="page-differential" class="page" style="display:none;">
                <header class="content-header">
                    <h1>Differential Diagnosis</h1>
                </header>
                <div class="content-body">
                    <div class="card">
                        <div class="card-header">
                            <h2>Enter Symptoms</h2>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label>Chief Complaint / Symptoms</label>
                                <textarea id="symptoms-input" placeholder="Enter symptoms separated by commas (e.g., chest pain, shortness of breath, diaphoresis)"></textarea>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px;">
                                <div class="form-group">
                                    <label>Age</label>
                                    <input type="number" id="patient-age" placeholder="Years">
                                </div>
                                <div class="form-group">
                                    <label>Sex</label>
                                    <select id="patient-sex">
                                        <option value="">Select</option>
                                        <option value="M">Male</option>
                                        <option value="F">Female</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Duration</label>
                                    <input type="text" id="symptom-duration" placeholder="e.g., 2 days">
                                </div>
                            </div>
                            <button class="btn btn-primary" onclick="runDifferential()">Generate Differential</button>
                        </div>
                    </div>
                    <div class="card" id="differential-results" style="display: none;">
                        <div class="card-header">
                            <h2>Differential Diagnosis</h2>
                        </div>
                        <div class="card-body" id="differential-output">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Drug Interactions Page -->
            <div id="page-interactions" class="page" style="display:none;">
                <header class="content-header">
                    <h1>Drug Interactions</h1>
                </header>
                <div class="content-body">
                    <div class="card">
                        <div class="card-header">
                            <h2>Check Medications</h2>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label>Medications</label>
                                <textarea id="meds-input" placeholder="Enter medications, one per line (e.g., warfarin&#10;aspirin&#10;simvastatin)"></textarea>
                            </div>
                            <div class="form-group">
                                <label>eGFR (optional)</label>
                                <input type="number" id="egfr-input" placeholder="mL/min/1.73m²">
                                <p class="form-hint">For renal dosing adjustments</p>
                            </div>
                            <button class="btn btn-primary" onclick="checkInteractions()">Check Interactions</button>
                        </div>
                    </div>
                    <div class="card" id="interactions-results" style="display: none;">
                        <div class="card-header">
                            <h2>Interaction Results</h2>
                        </div>
                        <div class="card-body" id="interactions-output">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Lab Interpretation Page -->
            <div id="page-labs" class="page" style="display:none;">
                <header class="content-header">
                    <h1>Lab Interpretation</h1>
                </header>
                <div class="content-body">
                    <div class="card">
                        <div class="card-header">
                            <h2>Enter Lab Values</h2>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label>Lab Results</label>
                                <textarea id="labs-input" placeholder="Enter lab values (e.g., WBC: 12.5, Hgb: 8.2, Plt: 150, Cr: 2.1)"></textarea>
                            </div>
                            <div class="form-group">
                                <label>Clinical Context (optional)</label>
                                <input type="text" id="labs-context" placeholder="e.g., 65yo with fatigue and dyspnea">
                            </div>
                            <button class="btn btn-primary" onclick="interpretLabs()">Interpret Labs</button>
                        </div>
                    </div>
                    <div class="card" id="labs-results" style="display: none;">
                        <div class="card-header">
                            <h2>Interpretation</h2>
                        </div>
                        <div class="card-body" id="labs-output">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Integrations Page -->
            <div id="page-integrations" class="page" style="display:none;">
                <header class="content-header">
                    <h1>Integrations</h1>
                </header>
                <div class="content-body">
                    <div class="card">
                        <div class="card-header">
                            <h2>EHR Systems</h2>
                        </div>
                        <div class="card-body">
                            <div class="integration-card">
                                <div class="logo">E</div>
                                <div class="info">
                                    <h4>Epic</h4>
                                    <p>FHIR R4 integration for patient data, notes, and orders</p>
                                </div>
                                <button class="btn btn-secondary btn-sm">Connect</button>
                            </div>
                            <div class="integration-card">
                                <div class="logo">C</div>
                                <div class="info">
                                    <h4>Cerner</h4>
                                    <p>Bi-directional sync for patient records and clinical notes</p>
                                </div>
                                <button class="btn btn-secondary btn-sm">Connect</button>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h2>Practice Management</h2>
                        </div>
                        <div class="card-body">
                            <div class="integration-card">
                                <div class="logo">S</div>
                                <div class="info">
                                    <h4>SimplePractice</h4>
                                    <p>Sync appointments, notes, and client records</p>
                                </div>
                                <button class="btn btn-secondary btn-sm">Connect</button>
                            </div>
                            <div class="integration-card">
                                <div class="logo">T</div>
                                <div class="info">
                                    <h4>TherapyNotes</h4>
                                    <p>Import client data and export session notes</p>
                                </div>
                                <button class="btn btn-secondary btn-sm">Connect</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Page -->
            <div id="page-settings" class="page" style="display:none;">
                <header class="content-header">
                    <h1>Settings</h1>
                </header>
                <div class="content-body">
                    <div class="card">
                        <div class="card-header">
                            <h2>Note Preferences</h2>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label>Default Note Format</label>
                                <select id="default-note-format">
                                    <option value="soap">SOAP</option>
                                    <option value="dap">DAP</option>
                                    <option value="birp">BIRP</option>
                                    <option value="progress">Progress Note</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Include Risk Assessment</label>
                                <select id="include-risk">
                                    <option value="yes">Yes - Flag risk indicators</option>
                                    <option value="no">No</option>
                                </select>
                            </div>
                            <button class="btn btn-primary">Save Preferences</button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2>Appearance</h2>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label>Theme</label>
                                <select id="theme-select">
                                    <option value="light">Light</option>
                                    <option value="dark">Dark</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- New Session Modal -->
    <div class="modal-backdrop" id="session-modal">
        <div class="modal">
            <div class="modal-header">
                <h3>New Session</h3>
                <button class="btn btn-icon btn-secondary" onclick="hideModal('session-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Patient (optional)</label>
                    <select id="session-patient">
                        <option value="">Select patient or leave blank</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Session Type</label>
                    <select id="session-type">
                        <option value="therapy">Therapy Session</option>
                        <option value="intake">Intake Assessment</option>
                        <option value="followup">Follow-up Visit</option>
                        <option value="crisis">Crisis Intervention</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Note Format</label>
                    <select id="session-note-format">
                        <option value="soap">SOAP</option>
                        <option value="dap">DAP</option>
                        <option value="birp">BIRP</option>
                        <option value="progress">Progress Note</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('session-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="startSession()"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:-2px;margin-right:4px"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="22"/></svg>Start Recording</button>
            </div>
        </div>
    </div>

    <script>
        // API Configuration
        const API_BASE = window.location.hostname === 'localhost' 
            ? 'http://localhost:8080' 
            : 'https://api.usecami.com';

        // Navigation
        function navigateTo(page) {
            document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            document.getElementById('page-' + page).style.display = 'block';
            document.querySelector('[data-page="' + page + '"]').classList.add('active');
        }

        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => navigateTo(item.dataset.page));
        });

        // Modal helpers
        function showModal(id) {
            document.getElementById(id).classList.add('active');
        }
        function hideModal(id) {
            document.getElementById(id).classList.remove('active');
        }
        function showNewSessionModal() { showModal('session-modal'); }
        function showNewPatientModal() { alert('Add patient - coming soon'); }

        // Helper: Get auth token if available
        function getAuthHeader() {
            const token = localStorage.getItem('cami-token');
            return token ? { 'Authorization': `Bearer ${token}` } : {};
        }

        // Clinical tools
        async function runDifferential() {
            const symptoms = document.getElementById('symptoms-input').value;
            const age = document.getElementById('patient-age').value;
            const sex = document.getElementById('patient-sex').value;
            
            if (!symptoms.trim()) {
                alert('Please enter symptoms');
                return;
            }

            document.getElementById('differential-results').style.display = 'block';
            document.getElementById('differential-output').innerHTML = '<div class="loading"><div class="spinner"></div> Analyzing symptoms...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/clinical/differential/quick`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        ...getAuthHeader()
                    },
                    body: JSON.stringify({
                        symptoms: symptoms,
                        age: age ? parseInt(age) : null,
                        sex: sex || null
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }
                
                const data = await response.json();
                renderDifferentialResults(data);
            } catch (error) {
                console.error('Differential diagnosis error:', error);
                document.getElementById('differential-output').innerHTML = `
                    <div style="padding: 16px; background: rgba(231,76,60,0.1); border-radius: 8px; color: var(--danger);">
                        <strong>Error:</strong> ${error.message || 'Failed to analyze symptoms. Please try again.'}
                    </div>
                `;
            }
        }

        function renderDifferentialResults(data) {
            let html = '';
            
            // Red flags first
            if (data.red_flags && data.red_flags.length > 0) {
                html += `<div style="padding: 12px; background: rgba(231,76,60,0.1); border-radius: 8px; margin-bottom: 16px;">
                    <strong style="color: var(--danger);">&#9888; Red Flags Detected:</strong>
                    <ul style="margin-top: 8px; padding-left: 20px;">`;
                for (const rf of data.red_flags) {
                    html += `<li><strong>${rf.description}</strong> (${rf.urgency})`;
                    if (rf.actions && rf.actions.length > 0) {
                        html += ` — ${rf.actions.join(', ')}`;
                    }
                    html += `</li>`;
                }
                html += `</ul></div>`;
            }
            
            // Summary
            if (data.summary) {
                html += `<p style="color: var(--muted); margin-bottom: 16px;">${data.summary}</p>`;
            }
            
            // Differentials
            if (data.differentials && data.differentials.length > 0) {
                html += `<ol style="line-height: 1.8; padding-left: 20px;">`;
                for (const d of data.differentials) {
                    const urgencyBadge = d.urgency === 'emergent' || d.urgency === 'urgent' 
                        ? `<span class="badge badge-danger" style="margin-left: 8px; font-size: 10px;">${d.urgency}</span>` 
                        : '';
                    html += `<li>
                        <strong>${d.condition}</strong>${urgencyBadge}
                        <span style="color: var(--muted);"> (confidence: ${(d.confidence * 100).toFixed(0)}%)</span>`;
                    if (d.tests && d.tests.length > 0) {
                        html += `<br><span style="font-size: 12px; color: var(--muted);">Key tests: ${d.tests.join(', ')}</span>`;
                    }
                    html += `</li>`;
                }
                html += `</ol>`;
            }
            
            // Overall urgency
            if (data.overall_urgency && (data.overall_urgency === 'emergent' || data.overall_urgency === 'urgent')) {
                html += `<p style="margin-top: 16px; padding: 12px; background: rgba(231,76,60,0.1); border-radius: 8px; color: var(--danger);">
                    <strong>&#9888; Urgency Level: ${data.overall_urgency.toUpperCase()}</strong> — Immediate clinical evaluation recommended
                </p>`;
            }
            
            // Processing time
            if (data.processing_time_ms) {
                html += `<p style="margin-top: 12px; font-size: 11px; color: var(--muted);">Analysis completed in ${data.processing_time_ms}ms</p>`;
            }
            
            document.getElementById('differential-output').innerHTML = html || '<p>No differential diagnoses generated.</p>';
        }

        async function checkInteractions() {
            const meds = document.getElementById('meds-input').value;
            const egfr = document.getElementById('egfr-input').value;
            
            if (!meds.trim()) {
                alert('Please enter medications');
                return;
            }

            document.getElementById('interactions-results').style.display = 'block';
            document.getElementById('interactions-output').innerHTML = '<div class="loading"><div class="spinner"></div> Checking interactions...</div>';
            
            try {
                // Convert newline-separated meds to comma-separated for the quick endpoint
                const medsCommaSeparated = meds.split('\n').map(m => m.trim()).filter(m => m).join(', ');
                
                const response = await fetch(`${API_BASE}/clinical/interactions/quick`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        ...getAuthHeader()
                    },
                    body: JSON.stringify({
                        medications: medsCommaSeparated
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }
                
                const data = await response.json();
                renderInteractionResults(data);
            } catch (error) {
                console.error('Drug interaction error:', error);
                document.getElementById('interactions-output').innerHTML = `
                    <div style="padding: 16px; background: rgba(231,76,60,0.1); border-radius: 8px; color: var(--danger);">
                        <strong>Error:</strong> ${error.message || 'Failed to check interactions. Please try again.'}
                    </div>
                `;
            }
        }

        function renderInteractionResults(data) {
            let html = '';
            
            // Summary
            if (data.summary) {
                const summaryClass = data.highest_severity === 'contraindicated' || data.highest_severity === 'major' 
                    ? 'badge-danger' : 'badge-warning';
                html += `<div style="margin-bottom: 16px; padding: 12px; background: var(--border-light); border-radius: 8px;">
                    <strong>Summary:</strong> ${data.summary}
                    ${data.critical_count > 0 ? `<span class="badge ${summaryClass}" style="margin-left: 8px;">${data.critical_count} critical</span>` : ''}
                </div>`;
            }
            
            // Interactions
            if (data.interactions && data.interactions.length > 0) {
                for (const interaction of data.interactions) {
                    let bgColor, textColor, icon;
                    switch (interaction.severity) {
                        case 'contraindicated':
                            bgColor = 'rgba(231,76,60,0.15)';
                            textColor = 'var(--danger)';
                            icon = '🚫';
                            break;
                        case 'major':
                            bgColor = 'rgba(231,76,60,0.1)';
                            textColor = 'var(--danger)';
                            icon = '\u9888';
                            break;
                        case 'moderate':
                            bgColor = 'rgba(243,156,18,0.1)';
                            textColor = 'var(--warning)';
                            icon = '\u26A1';
                            break;
                        default:
                            bgColor = 'rgba(52,152,219,0.1)';
                            textColor = 'var(--info)';
                            icon = 'ℹ️';
                    }
                    
                    html += `<div style="padding: 12px; background: ${bgColor}; border-radius: 8px; margin-bottom: 12px;">
                        <strong style="color: ${textColor};">${icon} ${interaction.severity.toUpperCase()}: ${interaction.drugs}</strong>
                        <p style="margin-top: 4px;">${interaction.effect}</p>
                        <p style="margin-top: 4px; font-size: 13px; color: var(--muted);"><strong>Management:</strong> ${interaction.management}</p>
                    </div>`;
                }
            } else {
                html += `<div style="padding: 16px; background: rgba(39,174,96,0.1); border-radius: 8px; color: var(--success);">
                    <strong>✓ No significant interactions found</strong>
                    <p style="margin-top: 4px;">Standard monitoring recommended.</p>
                </div>`;
            }
            
            // Black box warnings
            if (data.black_box_warnings && data.black_box_warnings.length > 0) {
                html += `<div style="margin-top: 16px; padding: 12px; background: rgba(0,0,0,0.05); border-radius: 8px; border-left: 4px solid var(--danger);">
                    <strong style="color: var(--danger);">&#9632; Black Box Warnings:</strong>
                    <ul style="margin-top: 8px; padding-left: 20px;">`;
                for (const bbw of data.black_box_warnings) {
                    html += `<li><strong>${bbw.drug}:</strong> ${bbw.warning}</li>`;
                }
                html += `</ul></div>`;
            }
            
            document.getElementById('interactions-output').innerHTML = html || '<p>No interaction data available.</p>';
        }

        async function interpretLabs() {
            const labs = document.getElementById('labs-input').value;
            const context = document.getElementById('labs-context').value;
            
            if (!labs.trim()) {
                alert('Please enter lab values');
                return;
            }

            document.getElementById('labs-results').style.display = 'block';
            document.getElementById('labs-output').innerHTML = '<div class="loading"><div class="spinner"></div> Interpreting labs...</div>';
            
            try {
                // Parse lab values from various formats:
                // "WBC: 12.5, Hgb: 8.2" or "WBC 12.5 Hgb 8.2" or "hemoglobin:10.5,wbc:15.2"
                const labsFormatted = labs
                    .replace(/[,;]/g, ',')
                    .replace(/:\s*/g, ':')
                    .split(/[,\n]+/)
                    .map(pair => {
                        const match = pair.match(/([a-zA-Z_]+)\s*[:=]?\s*([\d.]+)/);
                        if (match) {
                            return `${match[1].toLowerCase()}:${match[2]}`;
                        }
                        return null;
                    })
                    .filter(Boolean)
                    .join(',');
                
                const response = await fetch(`${API_BASE}/clinical/labs/quick`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        ...getAuthHeader()
                    },
                    body: JSON.stringify({
                        labs: labsFormatted
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }
                
                const data = await response.json();
                renderLabResults(data);
            } catch (error) {
                console.error('Lab interpretation error:', error);
                document.getElementById('labs-output').innerHTML = `
                    <div style="padding: 16px; background: rgba(231,76,60,0.1); border-radius: 8px; color: var(--danger);">
                        <strong>Error:</strong> ${error.message || 'Failed to interpret labs. Please try again.'}
                    </div>
                `;
            }
        }

        function renderLabResults(data) {
            let html = '';
            
            // Critical values first
            if (data.critical_count > 0) {
                html += `<div style="padding: 12px; background: rgba(231,76,60,0.15); border-radius: 8px; margin-bottom: 16px; border-left: 4px solid var(--danger);">
                    <strong style="color: var(--danger);">&#9888; CRITICAL VALUES DETECTED (${data.critical_count})</strong>
                    <p style="margin-top: 4px;">Immediate notification and clinical review required.</p>
                </div>`;
            }
            
            // Summary
            if (data.summary) {
                html += `<div style="margin-bottom: 16px; padding: 12px; background: var(--border-light); border-radius: 8px;">
                    <strong>Summary:</strong> ${data.summary}
                </div>`;
            }
            
            // Findings
            if (data.findings && data.findings.length > 0) {
                html += `<h4 style="margin-bottom: 12px;">Findings:</h4>
                <ul style="line-height: 1.8; padding-left: 20px;">`;
                for (const f of data.findings) {
                    const abnormalityColor = f.abnormality === 'critical' ? 'var(--danger)' 
                        : f.abnormality === 'high' || f.abnormality === 'low' ? 'var(--warning)'
                        : 'var(--muted)';
                    const criticalBadge = f.is_critical 
                        ? '<span class="badge badge-danger" style="margin-left: 8px;">CRITICAL</span>' 
                        : '';
                    
                    html += `<li>
                        <strong style="color: ${abnormalityColor};">${f.lab}: ${f.value} ${f.unit || ''}</strong>
                        ${criticalBadge}
                        <span style="color: var(--muted);"> (${f.abnormality})</span>
                        <br><span style="font-size: 13px;">${f.significance}</span>
                    </li>`;
                }
                html += `</ul>`;
            }
            
            // Patterns
            if (data.patterns && data.patterns.length > 0) {
                html += `<div style="margin-top: 16px; padding: 12px; background: rgba(52,152,219,0.1); border-radius: 8px;">
                    <strong style="color: var(--info);">&#9633; Patterns Detected:</strong>
                    <ul style="margin-top: 8px; padding-left: 20px;">`;
                for (const p of data.patterns) {
                    html += `<li><strong>${p.name}</strong> (confidence: ${(p.confidence * 100).toFixed(0)}%)
                        <br><span style="font-size: 13px; color: var(--muted);">Consider: ${p.conditions.join(', ')}</span>
                    </li>`;
                }
                html += `</ul></div>`;
            }
            
            // Urgency
            if (data.urgency && data.urgency !== 'routine') {
                const urgencyColor = data.urgency === 'critical' ? 'var(--danger)' : 'var(--warning)';
                html += `<p style="margin-top: 16px; padding: 12px; background: rgba(231,76,60,0.1); border-radius: 8px; color: ${urgencyColor};">
                    <strong>&#9888; Urgency: ${data.urgency.toUpperCase()}</strong>
                </p>`;
            }
            
            document.getElementById('labs-output').innerHTML = html || '<p>All labs within normal limits.</p>';
        }

        function startSession() {
            hideModal('session-modal');
            // Start recording with Cami Scribe
            window.location.href = '/app?mode=health';
        }

        // Theme
        const themeSelect = document.getElementById('theme-select');
        themeSelect.value = localStorage.getItem('cami-theme') || 'light';
        themeSelect.addEventListener('change', () => {
            const theme = themeSelect.value;
            if (theme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
            } else {
                document.documentElement.removeAttribute('data-theme');
            }
            localStorage.setItem('cami-theme', theme);
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Load initial dashboard stats from API
            loadDashboardStats();
        });

        async function loadDashboardStats() {
            // Load stats from health API when authenticated
            try {
                const token = localStorage.getItem('cami-token');
                if (!token) return;
                
                // Stats could be loaded from a future /health/stats endpoint
                // For now, leave as placeholder
            } catch (error) {
                console.log('Dashboard stats not available');
            }
        }
    </script>
</body>
</html>
