<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Legal Intelligence Dashboard â€” Cami</title>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg: #f5f1eb; --card: #faf8f5; --border: #c5d4c9; --border-light: #e8efe6;
            --text: #2c2620; --muted: #6b7a66; --accent: #5a7d64; --accent-hover: #4a6b54;
            --success: #4a7c59; --warning: #b8860b; --danger: #c0392b; --info: #2980b9;
            --sidebar-bg: #faf8f5; --sidebar-width: 240px;
        }
        [data-theme="dark"] {
            --bg: #0f1117; --card: #161822; --border: rgba(90,125,100,0.2); --border-light: rgba(90,125,100,0.1);
            --text: #e4e4e8; --muted: #9a9ba4; --accent: #6e9a7a; --accent-hover: #7eb08a;
            --success: #5a9a6a; --warning: #d4a843; --danger: #e74c3c; --info: #3498db;
            --sidebar-bg: #161822;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; }

        /* Layout */
        .app-layout { display: flex; min-height: 100vh; }
        
        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width); background: var(--sidebar-bg); border-right: 1px solid var(--border);
            position: fixed; top: 0; left: 0; bottom: 0; overflow-y: auto; z-index: 100;
        }
        .sidebar-header { padding: 20px; border-bottom: 1px solid var(--border); }
        .sidebar-logo { font-family: 'Libre Baskerville', Georgia, serif; font-size: 18px; font-weight: 700; color: var(--text); text-decoration: none; }
        .sidebar-logo span { font-weight: 400; font-size: 12px; color: var(--muted); display: block; margin-top: 2px; }
        .sidebar-nav { padding: 16px 12px; }
        .nav-section { margin-bottom: 24px; }
        .nav-section-title { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em; color: var(--muted); padding: 0 12px; margin-bottom: 8px; }
        .nav-item { display: flex; align-items: center; gap: 10px; padding: 10px 12px; border-radius: 8px; color: var(--muted); text-decoration: none; font-size: 14px; font-weight: 500; transition: all 0.15s; cursor: pointer; border: none; background: none; width: 100%; text-align: left; }
        .nav-item:hover { background: var(--border-light); color: var(--text); }
        .nav-item.active { background: rgba(90,125,100,0.1); color: var(--accent); }
        .nav-item .icon { font-size: 18px; width: 24px; text-align: center; }
        .nav-item .badge { margin-left: auto; background: var(--accent); color: #fff; font-size: 10px; font-weight: 700; padding: 2px 6px; border-radius: 10px; }

        /* Main content */
        .main-content { margin-left: var(--sidebar-width); flex: 1; min-height: 100vh; }
        .content-header { padding: 20px 32px; border-bottom: 1px solid var(--border); background: var(--card); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 50; }
        .content-header h1 { font-size: 20px; font-weight: 600; }
        .content-header .actions { display: flex; gap: 12px; }
        .content-body { padding: 32px; }

        /* Cards */
        .card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; margin-bottom: 24px; }
        .card-header { padding: 16px 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .card-header h2 { font-size: 14px; font-weight: 600; }
        .card-body { padding: 20px; }
        .card-footer { padding: 12px 20px; border-top: 1px solid var(--border); background: var(--border-light); border-radius: 0 0 12px 12px; }

        /* Buttons */
        .btn { display: inline-flex; align-items: center; gap: 6px; padding: 10px 18px; border-radius: 8px; font-size: 13px; font-weight: 600; border: none; cursor: pointer; text-decoration: none; transition: all 0.15s; }
        .btn:hover { transform: translateY(-1px); }
        .btn-primary { background: var(--accent); color: #fff; }
        .btn-primary:hover { background: var(--accent-hover); }
        .btn-secondary { background: var(--card); border: 1px solid var(--border); color: var(--text); }
        .btn-secondary:hover { border-color: var(--accent); color: var(--accent); }
        .btn-danger { background: var(--danger); color: #fff; }
        .btn-sm { padding: 6px 12px; font-size: 12px; }
        .btn-icon { width: 36px; height: 36px; padding: 0; justify-content: center; }

        /* Stats grid */
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 32px; }
        .stat-card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 20px; }
        .stat-card .stat-value { font-size: 32px; font-weight: 700; color: var(--accent); margin-bottom: 4px; }
        .stat-card .stat-label { font-size: 13px; color: var(--muted); }
        .stat-card .stat-change { font-size: 12px; margin-top: 8px; }
        .stat-card .stat-change.positive { color: var(--success); }
        .stat-card .stat-change.negative { color: var(--danger); }

        /* Tables */
        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th, .data-table td { padding: 12px 16px; text-align: left; border-bottom: 1px solid var(--border); }
        .data-table th { font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; color: var(--muted); background: var(--border-light); }
        .data-table tr:hover { background: var(--border-light); }
        .data-table .actions { display: flex; gap: 8px; }

        /* File upload */
        .file-drop { border: 2px dashed var(--border); border-radius: 12px; padding: 48px; text-align: center; cursor: pointer; transition: all 0.2s; }
        .file-drop:hover, .file-drop.drag-over { border-color: var(--accent); background: rgba(90,125,100,0.05); }
        .file-drop .icon { font-size: 48px; margin-bottom: 16px; color: var(--muted); }
        .file-drop .text { font-size: 16px; font-weight: 500; color: var(--text); margin-bottom: 8px; }
        .file-drop .hint { font-size: 13px; color: var(--muted); }
        .file-drop input { display: none; }

        /* Status badges */
        .badge { display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 600; text-transform: uppercase; }
        .badge-success { background: rgba(39,174,96,0.1); color: var(--success); }
        .badge-warning { background: rgba(243,156,18,0.1); color: var(--warning); }
        .badge-danger { background: rgba(231,76,60,0.1); color: var(--danger); }
        .badge-info { background: rgba(52,152,219,0.1); color: var(--info); }
        .badge-neutral { background: var(--border-light); color: var(--muted); }

        /* Tabs */
        .tabs { display: flex; gap: 0; border-bottom: 2px solid var(--border); margin-bottom: 24px; }
        .tab { padding: 12px 20px; font-size: 14px; font-weight: 500; color: var(--muted); cursor: pointer; border-bottom: 2px solid transparent; margin-bottom: -2px; transition: all 0.15s; background: none; border-top: none; border-left: none; border-right: none; }
        .tab:hover { color: var(--text); }
        .tab.active { color: var(--accent); border-bottom-color: var(--accent); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* Search */
        .search-box { display: flex; align-items: center; gap: 8px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px; padding: 8px 12px; }
        .search-box input { flex: 1; border: none; background: none; font-size: 14px; color: var(--text); outline: none; }
        .search-box .icon { color: var(--muted); }

        /* Modal */
        .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 1000; display: none; align-items: center; justify-content: center; }
        .modal-backdrop.active { display: flex; }
        .modal { background: var(--card); border-radius: 16px; max-width: 560px; width: 90%; max-height: 90vh; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.2); }
        .modal-header { padding: 20px 24px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .modal-header h3 { font-size: 18px; font-weight: 600; }
        .modal-body { padding: 24px; max-height: 60vh; overflow-y: auto; }
        .modal-footer { padding: 16px 24px; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 12px; }

        /* Form */
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-size: 13px; font-weight: 600; color: var(--text); margin-bottom: 8px; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 10px 14px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px; background: var(--bg); color: var(--text); }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: var(--accent); }
        .form-group textarea { min-height: 100px; resize: vertical; }
        .form-hint { font-size: 12px; color: var(--muted); margin-top: 6px; }

        /* Empty state */
        .empty-state { text-align: center; padding: 60px 24px; color: var(--muted); }
        .empty-state .icon { font-size: 64px; margin-bottom: 16px; opacity: 0.5; }
        .empty-state h3 { font-size: 18px; font-weight: 600; color: var(--text); margin-bottom: 8px; }
        .empty-state p { font-size: 14px; margin-bottom: 20px; }

        /* Loading */
        .loading { display: flex; align-items: center; justify-content: center; padding: 40px; color: var(--muted); }
        .spinner { width: 24px; height: 24px; border: 2px solid var(--border); border-top-color: var(--accent); border-radius: 50%; animation: spin 0.8s linear infinite; margin-right: 12px; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Quick actions */
        .quick-actions { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 32px; }
        .quick-action { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 20px; text-align: center; cursor: pointer; transition: all 0.15s; text-decoration: none; color: var(--text); }
        .quick-action:hover { border-color: var(--accent); transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        .quick-action .icon { font-size: 28px; margin-bottom: 12px; }
        .quick-action h4 { font-size: 14px; font-weight: 600; margin-bottom: 4px; }
        .quick-action p { font-size: 12px; color: var(--muted); }

        /* Document list */
        .doc-item { display: flex; align-items: center; gap: 16px; padding: 16px; border-bottom: 1px solid var(--border); }
        .doc-item:last-child { border-bottom: none; }
        .doc-item:hover { background: var(--border-light); }
        .doc-icon { width: 44px; height: 44px; background: var(--border-light); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .doc-info { flex: 1; }
        .doc-info h4 { font-size: 14px; font-weight: 600; margin-bottom: 4px; }
        .doc-info .meta { font-size: 12px; color: var(--muted); }
        .doc-actions { display: flex; gap: 8px; }

        /* Integration card */
        .integration-card { display: flex; align-items: center; gap: 16px; padding: 20px; border: 1px solid var(--border); border-radius: 12px; margin-bottom: 12px; }
        .integration-card .logo { width: 48px; height: 48px; background: var(--border-light); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 16px; }
        .integration-card .info { flex: 1; }
        .integration-card .info h4 { font-size: 16px; font-weight: 600; margin-bottom: 4px; }
        .integration-card .info p { font-size: 13px; color: var(--muted); }

        /* Responsive */
        @media (max-width: 1024px) {
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .quick-actions { grid-template-columns: repeat(2, 1fr); }
        }
        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); }
            .sidebar.open { transform: translateX(0); }
            .main-content { margin-left: 0; }
            .stats-grid, .quick-actions { grid-template-columns: 1fr; }
        }
    </style>
    <script>(function(){try{var t=localStorage.getItem('cami-theme');if(t==='dark')document.documentElement.setAttribute('data-theme','dark');}catch(_){}})();</script>
</head>
<body>
    <div class="app-layout">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/" class="sidebar-logo">Cami <span>Legal Intelligence</span></a>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Overview</div>
                    <button class="nav-item active" data-page="dashboard">
                        <span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="9" rx="1"/><rect x="14" y="3" width="7" height="5" rx="1"/><rect x="14" y="12" width="7" height="9" rx="1"/><rect x="3" y="16" width="7" height="5" rx="1"/></svg></span> Dashboard
                    </button>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Documents</div>
                    <button class="nav-item" data-page="vault">
                        <span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="4" width="20" height="16" rx="2"/><line x1="2" y1="10" x2="22" y2="10"/><circle cx="12" cy="15" r="2"/></svg></span> Document Vault
                    </button>
                    <button class="nav-item" data-page="contracts">
                        <span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg></span> Contract Analysis
                    </button>
                    <button class="nav-item" data-page="review">
                        <span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="9" y1="3" x2="9" y2="21"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="3" y1="15" x2="21" y2="15"/></svg></span> Review Tables
                    </button>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Collaboration</div>
                    <button class="nav-item" data-page="spaces">
                        <span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg></span> Shared Spaces
                    </button>
                    <button class="nav-item" data-page="workflows">
                        <span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg></span> Workflows
                    </button>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Settings</div>
                    <button class="nav-item" data-page="integrations">
                        <span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg></span> Integrations
                    </button>
                    <button class="nav-item" data-page="settings">
                        <span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg></span> Settings
                    </button>
                </div>
            </nav>
        </aside>

        <!-- Main content -->
        <main class="main-content">
            <!-- Dashboard Page -->
            <div id="page-dashboard" class="page active">
                <header class="content-header">
                    <h1>Dashboard</h1>
                    <div class="actions">
                        <button class="btn btn-secondary btn-sm" onclick="location.href='/app'"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:-2px;margin-right:4px"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>Chat</button>
                        <button class="btn btn-primary btn-sm" onclick="showUploadModal()"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:-2px;margin-right:4px"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>Upload Document</button>
                    </div>
                </header>
                <div class="content-body">
                    <!-- Stats -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="stat-docs">0</div>
                            <div class="stat-label">Documents</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="stat-contracts">0</div>
                            <div class="stat-label">Contracts Analyzed</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="stat-workflows">0</div>
                            <div class="stat-label">Active Workflows</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="stat-spaces">0</div>
                            <div class="stat-label">Shared Spaces</div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <h2 style="font-size: 14px; font-weight: 600; margin-bottom: 16px;">Quick Actions</h2>
                    <div class="quick-actions">
                        <a href="#" class="quick-action" onclick="showUploadModal(); return false;">
                            <div class="icon"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg></div>
                            <h4>Upload Documents</h4>
                            <p>Add files to your vault</p>
                        </a>
                        <a href="#" class="quick-action" onclick="navigateTo('contracts'); return false;">
                            <div class="icon"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg></div>
                            <h4>Analyze Contract</h4>
                            <p>Extract terms & risks</p>
                        </a>
                        <a href="#" class="quick-action" onclick="navigateTo('review'); return false;">
                            <div class="icon"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="9" y1="3" x2="9" y2="21"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="3" y1="15" x2="21" y2="15"/></svg></div>
                            <h4>Create Review Table</h4>
                            <p>Bulk document review</p>
                        </a>
                        <a href="#" class="quick-action" onclick="navigateTo('workflows'); return false;">
                            <div class="icon"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg></div>
                            <h4>Start Workflow</h4>
                            <p>Automate legal tasks</p>
                        </a>
                    </div>

                    <!-- Recent Documents -->
                    <div class="card">
                        <div class="card-header">
                            <h2>Recent Documents</h2>
                            <button class="btn btn-secondary btn-sm" onclick="navigateTo('vault')">View All</button>
                        </div>
                        <div class="card-body" id="recent-docs">
                            <div class="empty-state">
                                <div class="icon"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="2" y="4" width="20" height="16" rx="2"/><line x1="2" y1="10" x2="22" y2="10"/><circle cx="12" cy="15" r="2"/></svg></div>
                                <h3>No documents yet</h3>
                                <p>Upload your first document to get started</p>
                                <button class="btn btn-primary" onclick="showUploadModal()">Upload Document</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Document Vault Page -->
            <div id="page-vault" class="page" style="display:none;">
                <header class="content-header">
                    <h1>Document Vault</h1>
                    <div class="actions">
                        <div class="search-box">
                            <span class="icon"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></span>
                            <input type="text" placeholder="Search documents..." id="vault-search">
                        </div>
                        <button class="btn btn-primary btn-sm" onclick="showUploadModal()"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:-1px"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg> Upload</button>
                    </div>
                </header>
                <div class="content-body">
                    <div class="file-drop" id="file-drop">
                        <div class="icon"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/><line x1="12" y1="11" x2="12" y2="17"/><polyline points="9 14 12 11 15 14"/></svg></div>
                        <div class="text">Drag and drop files here</div>
                        <div class="hint">or click to browse (PDF, DOCX, TXT)</div>
                        <input type="file" id="file-input" multiple accept=".pdf,.docx,.doc,.txt">
                    </div>
                    <div class="card" style="margin-top: 24px;">
                        <div class="card-header">
                            <h2>All Documents</h2>
                        </div>
                        <div class="card-body" id="vault-docs">
                            <div class="loading"><div class="spinner"></div> Loading documents...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Contract Analysis Page -->
            <div id="page-contracts" class="page" style="display:none;">
                <header class="content-header">
                    <h1>Contract Analysis</h1>
                    <div class="actions">
                        <button class="btn btn-primary btn-sm" onclick="showAnalyzeModal()"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:-1px"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg> Analyze Contract</button>
                    </div>
                </header>
                <div class="content-body">
                    <div class="card">
                        <div class="card-header">
                            <h2>Analyzed Contracts</h2>
                        </div>
                        <div class="card-body" id="contracts-list">
                            <div class="empty-state">
                                <div class="icon"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg></div>
                                <h3>No contracts analyzed</h3>
                                <p>Upload a contract to extract key terms, identify risks, and track obligations</p>
                                <button class="btn btn-primary" onclick="showAnalyzeModal()">Analyze Contract</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Review Tables Page -->
            <div id="page-review" class="page" style="display:none;">
                <header class="content-header">
                    <h1>Review Tables</h1>
                    <div class="actions">
                        <button class="btn btn-primary btn-sm" onclick="showCreateTableModal()"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:-1px"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg> Create Table</button>
                    </div>
                </header>
                <div class="content-body">
                    <h2 style="font-size: 14px; font-weight: 600; margin-bottom: 16px;">Templates</h2>
                    <div class="quick-actions" style="grid-template-columns: repeat(4, 1fr);">
                        <a href="#" class="quick-action" onclick="createFromTemplate('contract_review'); return false;">
                            <div class="icon"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg></div>
                            <h4>Contract Review</h4>
                            <p>M&A due diligence</p>
                        </a>
                        <a href="#" class="quick-action" onclick="createFromTemplate('privilege_log'); return false;">
                            <div class="icon"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg></div>
                            <h4>Privilege Log</h4>
                            <p>Document privilege</p>
                        </a>
                        <a href="#" class="quick-action" onclick="createFromTemplate('discovery_review'); return false;">
                            <div class="icon"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></div>
                            <h4>Discovery Review</h4>
                            <p>E-discovery docs</p>
                        </a>
                        <a href="#" class="quick-action" onclick="createFromTemplate('lease_abstract'); return false;">
                            <div class="icon"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg></div>
                            <h4>Lease Abstract</h4>
                            <p>Real estate leases</p>
                        </a>
                    </div>

                    <div class="card" style="margin-top: 24px;">
                        <div class="card-header">
                            <h2>Your Tables</h2>
                        </div>
                        <div class="card-body" id="review-tables-list">
                            <div class="empty-state">
                                <div class="icon"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="9" y1="3" x2="9" y2="21"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="3" y1="15" x2="21" y2="15"/></svg></div>
                                <h3>No review tables</h3>
                                <p>Create a table or use a template to get started</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Shared Spaces Page -->
            <div id="page-spaces" class="page" style="display:none;">
                <header class="content-header">
                    <h1>Shared Spaces</h1>
                    <div class="actions">
                        <button class="btn btn-primary btn-sm" onclick="showCreateSpaceModal()"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:-1px"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg> Create Space</button>
                    </div>
                </header>
                <div class="content-body">
                    <div class="card">
                        <div class="card-header">
                            <h2>Your Spaces</h2>
                        </div>
                        <div class="card-body" id="spaces-list">
                            <div class="empty-state">
                                <div class="icon"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg></div>
                                <h3>No shared spaces</h3>
                                <p>Create a space to collaborate with clients and team members</p>
                                <button class="btn btn-primary" onclick="showCreateSpaceModal()">Create Space</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Workflows Page -->
            <div id="page-workflows" class="page" style="display:none;">
                <header class="content-header">
                    <h1>Workflows</h1>
                    <div class="actions">
                        <button class="btn btn-primary btn-sm" onclick="showWorkflowsModal()"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:-1px"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg> Start Workflow</button>
                    </div>
                </header>
                <div class="content-body">
                    <h2 style="font-size: 14px; font-weight: 600; margin-bottom: 16px;">Available Workflows</h2>
                    <div class="quick-actions" style="grid-template-columns: repeat(4, 1fr);">
                        <a href="#" class="quick-action" onclick="startWorkflow('translation'); return false;">
                            <div class="icon"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg></div>
                            <h4>Translation</h4>
                            <p>Multi-language docs</p>
                        </a>
                        <a href="#" class="quick-action" onclick="startWorkflow('redline'); return false;">
                            <div class="icon"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg></div>
                            <h4>Redline Summary</h4>
                            <p>Compare versions</p>
                        </a>
                        <a href="#" class="quick-action" onclick="startWorkflow('due_diligence'); return false;">
                            <div class="icon"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></div>
                            <h4>Due Diligence</h4>
                            <p>M&A review</p>
                        </a>
                        <a href="#" class="quick-action" onclick="startWorkflow('proofreading'); return false;">
                            <div class="icon"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 19l7-7 3 3-7 7-3-3z"/><path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/><path d="M2 2l7.586 7.586"/><circle cx="11" cy="11" r="2"/></svg></div>
                            <h4>Proofreading</h4>
                            <p>Multi-pass review</p>
                        </a>
                    </div>

                    <div class="card" style="margin-top: 24px;">
                        <div class="card-header">
                            <h2>Running Workflows</h2>
                        </div>
                        <div class="card-body" id="workflows-list">
                            <div class="empty-state">
                                <div class="icon"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg></div>
                                <h3>No active workflows</h3>
                                <p>Start a workflow to automate legal tasks</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Integrations Page -->
            <div id="page-integrations" class="page" style="display:none;">
                <header class="content-header">
                    <h1>Integrations</h1>
                </header>
                <div class="content-body">
                    <div class="card">
                        <div class="card-header">
                            <h2>Practice Management</h2>
                        </div>
                        <div class="card-body">
                            <div class="integration-card" id="int-clio">
                                <div class="logo" style="background: #1a73e8; color: white;">C</div>
                                <div class="info">
                                    <h4>Clio</h4>
                                    <p>Bi-directional sync for matters, contacts, documents, and time entries</p>
                                </div>
                                <button class="btn btn-secondary btn-sm" onclick="connectIntegration('clio')">Connect</button>
                            </div>
                            <div class="integration-card" id="int-mycase">
                                <div class="logo" style="background: #00a651; color: white;">M</div>
                                <div class="info">
                                    <h4>MyCase</h4>
                                    <p>Sync cases, contacts, documents, and calendar events</p>
                                </div>
                                <button class="btn btn-secondary btn-sm" onclick="connectIntegration('mycase')">Connect</button>
                            </div>
                            <div class="integration-card" id="int-practicepanther">
                                <div class="logo" style="background: #f15a29; color: white;">P</div>
                                <div class="info">
                                    <h4>PracticePanther</h4>
                                    <p>Full integration with matters, contacts, and billing</p>
                                </div>
                                <button class="btn btn-secondary btn-sm" onclick="connectIntegration('practicepanther')">Connect</button>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2>Cloud Storage</h2>
                        </div>
                        <div class="card-body">
                            <div class="integration-card" id="int-dropbox">
                                <div class="logo" style="background: #0061ff; color: white;">D</div>
                                <div class="info">
                                    <h4>Dropbox</h4>
                                    <p>Import documents directly from your Dropbox account</p>
                                </div>
                                <button class="btn btn-secondary btn-sm" onclick="connectIntegration('dropbox')">Connect</button>
                            </div>
                            <div class="integration-card" id="int-gdrive">
                                <div class="logo" style="background: #4285f4; color: white;">G</div>
                                <div class="info">
                                    <h4>Google Drive</h4>
                                    <p>Sync documents with Google Drive folders</p>
                                </div>
                                <button class="btn btn-secondary btn-sm" onclick="connectIntegration('gdrive')">Connect</button>
                            </div>
                            <div class="integration-card" id="int-onedrive">
                                <div class="logo" style="background: #0078d4; color: white;">O</div>
                                <div class="info">
                                    <h4>OneDrive</h4>
                                    <p>Connect to Microsoft OneDrive and SharePoint</p>
                                </div>
                                <button class="btn btn-secondary btn-sm" onclick="connectIntegration('onedrive')">Connect</button>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2>E-Signature</h2>
                        </div>
                        <div class="card-body">
                            <div class="integration-card" id="int-docusign">
                                <div class="logo" style="background: #ffcc00; color: #000;">D</div>
                                <div class="info">
                                    <h4>DocuSign</h4>
                                    <p>Send documents for electronic signature directly from vault</p>
                                </div>
                                <button class="btn btn-secondary btn-sm" onclick="connectIntegration('docusign')">Connect</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Page -->
            <div id="page-settings" class="page" style="display:none;">
                <header class="content-header">
                    <h1>Settings</h1>
                </header>
                <div class="content-body">
                    <div class="card">
                        <div class="card-header">
                            <h2>Account Settings</h2>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label>Business Name</label>
                                <input type="text" id="setting-business-name" placeholder="Your firm name">
                            </div>
                            <div class="form-group">
                                <label>API Key</label>
                                <input type="text" id="setting-api-key" readonly placeholder="Your API key">
                                <p class="form-hint">Use this key to access the API programmatically</p>
                            </div>
                            <button class="btn btn-primary">Save Changes</button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2>Appearance</h2>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label>Theme</label>
                                <select id="theme-select">
                                    <option value="light">Light</option>
                                    <option value="dark">Dark</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Upload Modal -->
    <div class="modal-backdrop" id="upload-modal">
        <div class="modal">
            <div class="modal-header">
                <h3>Upload Documents</h3>
                <button class="btn btn-icon btn-secondary" onclick="hideModal('upload-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="file-drop" id="modal-file-drop" style="padding: 32px;">
                    <div class="icon"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/><line x1="12" y1="11" x2="12" y2="17"/><polyline points="9 14 12 11 15 14"/></svg></div>
                    <div class="text">Drop files here</div>
                    <div class="hint">PDF, DOCX, TXT (max 50MB)</div>
                    <input type="file" id="modal-file-input" multiple accept=".pdf,.docx,.doc,.txt">
                </div>
                <div id="upload-file-list" style="margin-top: 16px;"></div>
                <div id="upload-progress" style="margin-top: 16px; display: none;">
                    <div class="loading"><div class="spinner"></div> <span id="upload-status">Uploading...</span></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('upload-modal')">Cancel</button>
                <button class="btn btn-primary" id="upload-btn" disabled onclick="uploadFiles()">Upload</button>
            </div>
        </div>
    </div>

    <!-- Analyze Contract Modal -->
    <div class="modal-backdrop" id="analyze-modal">
        <div class="modal" style="max-width: 700px;">
            <div class="modal-header">
                <h3>Analyze Contract</h3>
                <button class="btn btn-icon btn-secondary" onclick="hideModal('analyze-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Select Document from Vault</label>
                    <select id="analyze-doc-select" style="width: 100%;">
                        <option value="">Loading documents...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Or paste contract text</label>
                    <textarea id="analyze-text" placeholder="Paste contract text here for analysis..." rows="6"></textarea>
                </div>
                <div id="analyze-progress" style="display: none;">
                    <div class="loading"><div class="spinner"></div> Analyzing contract...</div>
                </div>
                <div id="analyze-results" style="display: none; margin-top: 16px;"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('analyze-modal')">Close</button>
                <button class="btn btn-primary" id="analyze-btn" onclick="analyzeContract()">Analyze</button>
            </div>
        </div>
    </div>

    <!-- Create Review Table Modal -->
    <div class="modal-backdrop" id="create-table-modal">
        <div class="modal">
            <div class="modal-header">
                <h3>Create Review Table</h3>
                <button class="btn btn-icon btn-secondary" onclick="hideModal('create-table-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Table Name</label>
                    <input type="text" id="table-name" placeholder="e.g., Q1 Contract Review">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="table-description" placeholder="Optional description..." rows="2"></textarea>
                </div>
                <div class="form-group">
                    <label>Template (Optional)</label>
                    <select id="table-template">
                        <option value="">Custom table (no template)</option>
                        <option value="contract_review">Contract Review - M&A due diligence</option>
                        <option value="privilege_log">Privilege Log - Document privilege</option>
                        <option value="discovery_review">Discovery Review - E-discovery docs</option>
                        <option value="lease_abstract">Lease Abstract - Real estate leases</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('create-table-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="createReviewTable()">Create Table</button>
            </div>
        </div>
    </div>

    <!-- Create Space Modal -->
    <div class="modal-backdrop" id="create-space-modal">
        <div class="modal">
            <div class="modal-header">
                <h3>Create Shared Space</h3>
                <button class="btn btn-icon btn-secondary" onclick="hideModal('create-space-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Space Name</label>
                    <input type="text" id="space-name" placeholder="e.g., Acme Corp - M&A Deal">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="space-description" placeholder="Purpose of this shared space..." rows="2"></textarea>
                </div>
                <div class="form-group">
                    <label>Visibility</label>
                    <select id="space-visibility">
                        <option value="private">Private - Invite only</option>
                        <option value="team">Team - All firm members</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('create-space-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="createSharedSpace()">Create Space</button>
            </div>
        </div>
    </div>

    <!-- Start Workflow Modal -->
    <div class="modal-backdrop" id="workflow-modal">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header">
                <h3 id="workflow-modal-title">Start Workflow</h3>
                <button class="btn btn-icon btn-secondary" onclick="hideModal('workflow-modal')">&times;</button>
            </div>
            <div class="modal-body" id="workflow-modal-body">
                <!-- Dynamic content based on workflow type -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('workflow-modal')">Cancel</button>
                <button class="btn btn-primary" id="workflow-start-btn" onclick="executeWorkflow()">Start Workflow</button>
            </div>
        </div>
    </div>

    <!-- View Document Modal -->
    <div class="modal-backdrop" id="view-doc-modal">
        <div class="modal" style="max-width: 800px;">
            <div class="modal-header">
                <h3 id="view-doc-title">Document Details</h3>
                <button class="btn btn-icon btn-secondary" onclick="hideModal('view-doc-modal')">&times;</button>
            </div>
            <div class="modal-body" id="view-doc-body" style="max-height: 70vh; overflow-y: auto;">
                <div class="loading"><div class="spinner"></div> Loading...</div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('view-doc-modal')">Close</button>
                <button class="btn btn-primary" id="view-doc-analyze-btn" onclick="analyzeCurrentDoc()">Analyze</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" style="position: fixed; bottom: 24px; right: 24px; background: var(--card); border: 1px solid var(--border); border-radius: 8px; padding: 16px 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); display: none; z-index: 2000; max-width: 400px;">
        <div style="display: flex; align-items: center; gap: 12px;">
            <span id="toast-icon" style="font-size: 20px;"></span>
            <span id="toast-message"></span>
        </div>
    </div>

    <script>
        // =========================================================================
        // Configuration & State
        // =========================================================================
        const CONFIG = {
            businessId: localStorage.getItem('cami-business-id') || 'demo-business',
            userId: localStorage.getItem('cami-user-id') || 'demo-user',
            userEmail: localStorage.getItem('cami-user-email') || 'user@example.com',
            apiKey: localStorage.getItem('cami-api-key') || ''
        };

        const STATE = {
            documents: [],
            contracts: [],
            reviewTables: [],
            sharedSpaces: [],
            workflows: [],
            pendingFiles: [],
            currentWorkflow: null,
            currentDocument: null
        };

        // =========================================================================
        // API Service
        // =========================================================================
        const API = {
            headers() {
                const h = { 'Content-Type': 'application/json' };
                if (CONFIG.apiKey) h['Authorization'] = `Bearer ${CONFIG.apiKey}`;
                return h;
            },

            async get(url, params = {}) {
                const query = new URLSearchParams(params).toString();
                const fullUrl = query ? `${url}?${query}` : url;
                const res = await fetch(fullUrl, { headers: this.headers() });
                return res.json();
            },

            async post(url, data) {
                const res = await fetch(url, {
                    method: 'POST',
                    headers: this.headers(),
                    body: JSON.stringify(data)
                });
                return res.json();
            },

            async patch(url, data) {
                const res = await fetch(url, {
                    method: 'PATCH',
                    headers: this.headers(),
                    body: JSON.stringify(data)
                });
                return res.json();
            },

            async delete(url, params = {}) {
                const query = new URLSearchParams(params).toString();
                const fullUrl = query ? `${url}?${query}` : url;
                const res = await fetch(fullUrl, {
                    method: 'DELETE',
                    headers: this.headers()
                });
                return res.json();
            },

            async uploadFile(file, folderId = null, tags = '') {
                const formData = new FormData();
                formData.append('file', file);
                if (folderId) formData.append('folder_id', folderId);
                if (tags) formData.append('tags', tags);
                formData.append('auto_analyze', 'true');

                const headers = {};
                if (CONFIG.apiKey) headers['Authorization'] = `Bearer ${CONFIG.apiKey}`;

                const res = await fetch('/api/v1/vault/documents/upload', {
                    method: 'POST',
                    headers,
                    body: formData
                });
                return res.json();
            },

            // Document Vault
            vault: {
                list: (params = {}) => API.get('/api/v1/vault/documents', { ...params, business_id: CONFIG.businessId }),
                get: (id) => API.get(`/api/v1/vault/documents/${id}`),
                delete: (id) => API.delete(`/api/v1/vault/documents/${id}`),
                search: (query) => API.post('/api/v1/vault/search', { query, business_id: CONFIG.businessId }),
                upload: (file) => API.uploadFile(file)
            },

            // Review Tables
            tables: {
                list: () => API.get('/api/v1/review/tables', { business_id: CONFIG.businessId }),
                get: (id) => API.get(`/api/v1/review/tables/${id}`, { business_id: CONFIG.businessId }),
                create: (data) => API.post('/api/v1/review/tables', { ...data, business_id: CONFIG.businessId }),
                createFromTemplate: (templateId) => API.post('/api/v1/review/tables/from-template', { 
                    template_id: templateId, 
                    business_id: CONFIG.businessId 
                }),
                delete: (id) => API.delete(`/api/v1/review/tables/${id}`, { business_id: CONFIG.businessId }),
                addDocuments: (tableId, docIds) => API.post(`/api/v1/review/tables/${tableId}/documents`, {
                    document_ids: docIds,
                    auto_analyze: true
                }),
                listRows: (tableId) => API.get(`/api/v1/review/tables/${tableId}/rows`, { business_id: CONFIG.businessId }),
                exportCsv: (tableId) => API.get(`/api/v1/review/tables/${tableId}/export/csv`, { business_id: CONFIG.businessId })
            },

            // Shared Spaces
            spaces: {
                list: () => API.get('/api/v1/spaces', { business_id: CONFIG.businessId }),
                get: (id) => API.get(`/api/v1/spaces/${id}`, { business_id: CONFIG.businessId }),
                create: (data) => API.post('/api/v1/spaces', { 
                    ...data, 
                    business_id: CONFIG.businessId,
                    created_by: CONFIG.userId,
                    creator_email: CONFIG.userEmail
                }),
                delete: (id) => API.delete(`/api/v1/spaces/${id}`, { 
                    business_id: CONFIG.businessId,
                    user_id: CONFIG.userId
                }),
                addMember: (spaceId, data) => API.post(`/api/v1/spaces/${spaceId}/members`, {
                    ...data,
                    invited_by: CONFIG.userId
                }),
                shareContent: (spaceId, data) => API.post(`/api/v1/spaces/${spaceId}/content`, {
                    ...data,
                    shared_by: CONFIG.userId
                })
            },

            // Contract Analysis
            contracts: {
                analyze: (text) => API.post('/legal-intelligence/analyze', {
                    message: `Analyze this contract and extract: parties, key dates, obligations, risks, and key terms:\n\n${text}`
                })
            },

            // Workflows
            workflows: {
                translate: (text, targetLang) => API.post('/legal-intelligence/case/translate', {
                    legal_text: text,
                    audience: targetLang
                }),
                redline: (doc1Text, doc2Text) => API.post('/api/v1/vault/compare', {
                    document_id_1: doc1Text,
                    document_id_2: doc2Text
                }),
                dueDiligence: (docs) => API.post('/api/v1/vault/bulk/analyze', {
                    document_ids: docs,
                    analysis_type: 'full'
                })
            }
        };

        // =========================================================================
        // Navigation
        // =========================================================================
        function navigateTo(page) {
            document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            const pageEl = document.getElementById('page-' + page);
            const navEl = document.querySelector('[data-page="' + page + '"]');
            
            if (pageEl) pageEl.style.display = 'block';
            if (navEl) navEl.classList.add('active');

            // Load page data
            switch(page) {
                case 'vault': loadVaultDocuments(); break;
                case 'contracts': loadContracts(); break;
                case 'review': loadReviewTables(); break;
                case 'spaces': loadSharedSpaces(); break;
                case 'workflows': loadWorkflows(); break;
            }
        }

        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => navigateTo(item.dataset.page));
        });

        // =========================================================================
        // Modal Helpers
        // =========================================================================
        function showModal(id) {
            document.getElementById(id).classList.add('active');
        }
        
        function hideModal(id) {
            document.getElementById(id).classList.remove('active');
        }

        function showUploadModal() {
            STATE.pendingFiles = [];
            document.getElementById('upload-file-list').innerHTML = '';
            document.getElementById('upload-progress').style.display = 'none';
            document.getElementById('upload-btn').disabled = true;
            showModal('upload-modal');
        }

        function showAnalyzeModal() {
            loadDocumentsForSelect();
            document.getElementById('analyze-text').value = '';
            document.getElementById('analyze-results').style.display = 'none';
            document.getElementById('analyze-progress').style.display = 'none';
            showModal('analyze-modal');
        }

        function showCreateTableModal() {
            document.getElementById('table-name').value = '';
            document.getElementById('table-description').value = '';
            document.getElementById('table-template').value = '';
            showModal('create-table-modal');
        }

        function showCreateSpaceModal() {
            document.getElementById('space-name').value = '';
            document.getElementById('space-description').value = '';
            document.getElementById('space-visibility').value = 'private';
            showModal('create-space-modal');
        }

        // =========================================================================
        // Toast Notifications
        // =========================================================================
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            const icon = document.getElementById('toast-icon');
            const msg = document.getElementById('toast-message');
            
            const icons = {
                success: 'âœ“',
                error: 'âœ•',
                info: 'â„¹',
                warning: 'âš '
            };
            
            const colors = {
                success: 'var(--success)',
                error: 'var(--danger)',
                info: 'var(--info)',
                warning: 'var(--warning)'
            };
            
            icon.textContent = icons[type];
            icon.style.color = colors[type];
            msg.textContent = message;
            
            toast.style.display = 'block';
            setTimeout(() => { toast.style.display = 'none'; }, 4000);
        }

        // =========================================================================
        // File Upload
        // =========================================================================
        function setupFileDrop(dropId, inputId) {
            const drop = document.getElementById(dropId);
            const input = document.getElementById(inputId);
            if (!drop) return;

            drop.addEventListener('click', (e) => {
                if (e.target === drop || e.target.closest('.file-drop')) {
                    input?.click();
                }
            });

            drop.addEventListener('dragover', e => {
                e.preventDefault();
                drop.classList.add('drag-over');
            });

            drop.addEventListener('dragleave', () => {
                drop.classList.remove('drag-over');
            });

            drop.addEventListener('drop', e => {
                e.preventDefault();
                drop.classList.remove('drag-over');
                handleFileSelect(e.dataTransfer.files);
            });

            input?.addEventListener('change', (e) => {
                handleFileSelect(e.target.files);
            });
        }

        function handleFileSelect(files) {
            if (!files || files.length === 0) return;
            
            STATE.pendingFiles = Array.from(files);
            const listEl = document.getElementById('upload-file-list');
            
            listEl.innerHTML = STATE.pendingFiles.map(f => `
                <div class="doc-item" style="padding: 8px 0;">
                    <div class="doc-icon" style="width: 32px; height: 32px; font-size: 14px;">
                        ${getFileIcon(f.name)}
                    </div>
                    <div class="doc-info">
                        <h4 style="font-size: 13px;">${f.name}</h4>
                        <span class="meta">${formatFileSize(f.size)}</span>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('upload-btn').disabled = false;
        }

        async function uploadFiles() {
            if (STATE.pendingFiles.length === 0) return;

            const progress = document.getElementById('upload-progress');
            const status = document.getElementById('upload-status');
            const btn = document.getElementById('upload-btn');
            
            progress.style.display = 'block';
            btn.disabled = true;

            let uploaded = 0;
            let failed = 0;

            for (const file of STATE.pendingFiles) {
                status.textContent = `Uploading ${file.name}...`;
                try {
                    const result = await API.vault.upload(file);
                    if (result.error) {
                        failed++;
                        console.error('Upload error:', result.error);
                    } else {
                        uploaded++;
                    }
                } catch (e) {
                    failed++;
                    console.error('Upload failed:', e);
                }
            }

            progress.style.display = 'none';
            hideModal('upload-modal');
            
            if (uploaded > 0) {
                showToast(`Successfully uploaded ${uploaded} file(s)`, 'success');
                loadDashboardStats();
                loadRecentDocuments();
                loadVaultDocuments();
            }
            if (failed > 0) {
                showToast(`Failed to upload ${failed} file(s)`, 'error');
            }

            STATE.pendingFiles = [];
        }

        // =========================================================================
        // Document Vault
        // =========================================================================
        async function loadVaultDocuments() {
            const container = document.getElementById('vault-docs');
            container.innerHTML = '<div class="loading"><div class="spinner"></div> Loading documents...</div>';

            try {
                const result = await API.vault.list({ limit: 100 });
                STATE.documents = result.documents || [];
                
                if (STATE.documents.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="icon"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="2" y="4" width="20" height="16" rx="2"/><line x1="2" y1="10" x2="22" y2="10"/><circle cx="12" cy="15" r="2"/></svg></div>
                            <h3>No documents yet</h3>
                            <p>Upload your first document to get started</p>
                            <button class="btn btn-primary" onclick="showUploadModal()">Upload Document</button>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = STATE.documents.map(doc => `
                    <div class="doc-item" data-id="${doc.id}">
                        <div class="doc-icon">${getFileIcon(doc.filename)}</div>
                        <div class="doc-info">
                            <h4>${doc.filename || doc.original_filename}</h4>
                            <span class="meta">${formatFileSize(doc.file_size)} â€¢ ${formatDate(doc.created_at)}</span>
                        </div>
                        <div class="doc-actions">
                            <button class="btn btn-secondary btn-sm" onclick="viewDocument('${doc.id}')">View</button>
                            <button class="btn btn-secondary btn-sm" onclick="analyzeDocFromVault('${doc.id}')">Analyze</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteDocument('${doc.id}')">Delete</button>
                        </div>
                    </div>
                `).join('');
            } catch (e) {
                console.error('Failed to load documents:', e);
                container.innerHTML = '<div class="empty-state"><h3>Failed to load documents</h3><p>Please try again later</p></div>';
            }
        }

        async function viewDocument(docId) {
            STATE.currentDocument = docId;
            showModal('view-doc-modal');
            
            const body = document.getElementById('view-doc-body');
            body.innerHTML = '<div class="loading"><div class="spinner"></div> Loading...</div>';

            try {
                const doc = await API.vault.get(docId);
                document.getElementById('view-doc-title').textContent = doc.filename || 'Document Details';
                
                const metadata = doc.metadata || {};
                body.innerHTML = `
                    <div style="margin-bottom: 20px;">
                        <table class="data-table">
                            <tr><td style="width: 140px; font-weight: 600;">Filename</td><td>${doc.filename || '-'}</td></tr>
                            <tr><td style="font-weight: 600;">Size</td><td>${formatFileSize(doc.file_size)}</td></tr>
                            <tr><td style="font-weight: 600;">Type</td><td>${doc.mime_type || '-'}</td></tr>
                            <tr><td style="font-weight: 600;">Uploaded</td><td>${formatDate(doc.created_at)}</td></tr>
                            ${metadata.document_type ? `<tr><td style="font-weight: 600;">Doc Type</td><td>${metadata.document_type}</td></tr>` : ''}
                            ${metadata.parties?.length ? `<tr><td style="font-weight: 600;">Parties</td><td>${metadata.parties.join(', ')}</td></tr>` : ''}
                            ${metadata.jurisdiction ? `<tr><td style="font-weight: 600;">Jurisdiction</td><td>${metadata.jurisdiction}</td></tr>` : ''}
                        </table>
                    </div>
                    ${metadata.summary ? `
                        <div style="margin-bottom: 20px;">
                            <h4 style="font-size: 13px; font-weight: 600; margin-bottom: 8px;">Summary</h4>
                            <p style="font-size: 14px; color: var(--muted); line-height: 1.6;">${metadata.summary}</p>
                        </div>
                    ` : ''}
                    ${metadata.key_terms?.length ? `
                        <div>
                            <h4 style="font-size: 13px; font-weight: 600; margin-bottom: 8px;">Key Terms</h4>
                            <div style="display: flex; flex-wrap: wrap; gap: 6px;">
                                ${metadata.key_terms.map(t => `<span class="badge badge-neutral">${t}</span>`).join('')}
                            </div>
                        </div>
                    ` : ''}
                `;
            } catch (e) {
                body.innerHTML = '<div class="empty-state"><h3>Failed to load document</h3></div>';
            }
        }

        async function deleteDocument(docId) {
            if (!confirm('Are you sure you want to delete this document?')) return;
            
            try {
                await API.vault.delete(docId);
                showToast('Document deleted', 'success');
                loadVaultDocuments();
                loadDashboardStats();
                loadRecentDocuments();
            } catch (e) {
                showToast('Failed to delete document', 'error');
            }
        }

        function analyzeDocFromVault(docId) {
            STATE.currentDocument = docId;
            document.getElementById('analyze-doc-select').value = docId;
            showAnalyzeModal();
        }

        async function analyzeCurrentDoc() {
            hideModal('view-doc-modal');
            analyzeDocFromVault(STATE.currentDocument);
        }

        // Search
        const vaultSearch = document.getElementById('vault-search');
        let searchTimeout;
        vaultSearch?.addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => searchDocuments(e.target.value), 300);
        });

        async function searchDocuments(query) {
            if (!query.trim()) {
                loadVaultDocuments();
                return;
            }

            const container = document.getElementById('vault-docs');
            container.innerHTML = '<div class="loading"><div class="spinner"></div> Searching...</div>';

            try {
                const result = await API.vault.search(query);
                const docs = result.results || [];
                
                if (docs.length === 0) {
                    container.innerHTML = '<div class="empty-state"><h3>No results found</h3><p>Try a different search term</p></div>';
                    return;
                }

                container.innerHTML = docs.map(doc => `
                    <div class="doc-item" data-id="${doc.id}">
                        <div class="doc-icon">${getFileIcon(doc.filename)}</div>
                        <div class="doc-info">
                            <h4>${doc.filename || doc.original_filename}</h4>
                            <span class="meta">${formatFileSize(doc.file_size)} â€¢ ${formatDate(doc.created_at)}</span>
                        </div>
                        <div class="doc-actions">
                            <button class="btn btn-secondary btn-sm" onclick="viewDocument('${doc.id}')">View</button>
                            <button class="btn btn-secondary btn-sm" onclick="analyzeDocFromVault('${doc.id}')">Analyze</button>
                        </div>
                    </div>
                `).join('');
            } catch (e) {
                container.innerHTML = '<div class="empty-state"><h3>Search failed</h3></div>';
            }
        }

        // =========================================================================
        // Contract Analysis
        // =========================================================================
        async function loadDocumentsForSelect() {
            const select = document.getElementById('analyze-doc-select');
            select.innerHTML = '<option value="">Loading...</option>';

            try {
                const result = await API.vault.list({ limit: 100 });
                const docs = result.documents || [];
                
                select.innerHTML = '<option value="">-- Select a document --</option>' + 
                    docs.map(d => `<option value="${d.id}">${d.filename}</option>`).join('');
            } catch (e) {
                select.innerHTML = '<option value="">Failed to load documents</option>';
            }
        }

        async function analyzeContract() {
            const docId = document.getElementById('analyze-doc-select').value;
            const text = document.getElementById('analyze-text').value.trim();
            
            if (!docId && !text) {
                showToast('Please select a document or paste contract text', 'warning');
                return;
            }

            const progress = document.getElementById('analyze-progress');
            const results = document.getElementById('analyze-results');
            const btn = document.getElementById('analyze-btn');
            
            progress.style.display = 'block';
            results.style.display = 'none';
            btn.disabled = true;

            try {
                let contractText = text;
                
                if (docId && !text) {
                    // Get document text
                    const doc = await API.vault.get(docId);
                    contractText = doc.extracted_text || '';
                    if (!contractText) {
                        throw new Error('Document has no extractable text');
                    }
                }

                const result = await API.contracts.analyze(contractText);
                
                results.style.display = 'block';
                results.innerHTML = `
                    <div class="card" style="margin-bottom: 0;">
                        <div class="card-header">
                            <h2>Analysis Results</h2>
                        </div>
                        <div class="card-body">
                            <div style="white-space: pre-wrap; font-size: 14px; line-height: 1.7;">${result.response || result.error || 'No results'}</div>
                        </div>
                    </div>
                `;

                // Store in analyzed contracts
                STATE.contracts.push({
                    id: docId || Date.now().toString(),
                    name: docId ? (STATE.documents.find(d => d.id === docId)?.filename || 'Contract') : 'Pasted Contract',
                    analyzed_at: new Date().toISOString(),
                    result: result.response
                });
                
                loadContracts();
            } catch (e) {
                results.style.display = 'block';
                results.innerHTML = `<div class="empty-state"><h3>Analysis failed</h3><p>${e.message}</p></div>`;
            } finally {
                progress.style.display = 'none';
                btn.disabled = false;
            }
        }

        function loadContracts() {
            const container = document.getElementById('contracts-list');
            
            if (STATE.contracts.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg></div>
                        <h3>No contracts analyzed</h3>
                        <p>Upload a contract to extract key terms, identify risks, and track obligations</p>
                        <button class="btn btn-primary" onclick="showAnalyzeModal()">Analyze Contract</button>
                    </div>
                `;
                return;
            }

            container.innerHTML = STATE.contracts.map(c => `
                <div class="doc-item">
                    <div class="doc-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg></div>
                    <div class="doc-info">
                        <h4>${c.name}</h4>
                        <span class="meta">Analyzed ${formatDate(c.analyzed_at)}</span>
                    </div>
                    <span class="badge badge-success">Analyzed</span>
                </div>
            `).join('');

            updateStat('stat-contracts', STATE.contracts.length);
        }

        // =========================================================================
        // Review Tables
        // =========================================================================
        async function loadReviewTables() {
            const container = document.getElementById('review-tables-list');
            container.innerHTML = '<div class="loading"><div class="spinner"></div> Loading tables...</div>';

            try {
                const result = await API.tables.list();
                STATE.reviewTables = result.tables || [];
                
                if (STATE.reviewTables.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="icon"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="9" y1="3" x2="9" y2="21"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="3" y1="15" x2="21" y2="15"/></svg></div>
                            <h3>No review tables</h3>
                            <p>Create a table or use a template to get started</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = STATE.reviewTables.map(t => `
                    <div class="doc-item">
                        <div class="doc-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="9" y1="3" x2="9" y2="21"/><line x1="3" y1="9" x2="21" y2="9"/></svg></div>
                        <div class="doc-info">
                            <h4>${t.name}</h4>
                            <span class="meta">${t.statistics?.total_rows || 0} rows â€¢ Created ${formatDate(t.created_at)}</span>
                        </div>
                        <div class="doc-actions">
                            <button class="btn btn-secondary btn-sm" onclick="exportTable('${t.id}')">Export CSV</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteTable('${t.id}')">Delete</button>
                        </div>
                    </div>
                `).join('');
            } catch (e) {
                container.innerHTML = '<div class="empty-state"><h3>Failed to load tables</h3></div>';
            }
        }

        async function createReviewTable() {
            const name = document.getElementById('table-name').value.trim();
            const description = document.getElementById('table-description').value.trim();
            const template = document.getElementById('table-template').value;

            if (!name && !template) {
                showToast('Please enter a table name or select a template', 'warning');
                return;
            }

            try {
                let result;
                if (template) {
                    result = await API.tables.createFromTemplate(template);
                } else {
                    result = await API.tables.create({
                        name,
                        description,
                        columns: [
                            { name: 'Document', type: 'text', required: true },
                            { name: 'Status', type: 'select', options: ['Pending', 'In Review', 'Approved', 'Rejected'] },
                            { name: 'Notes', type: 'text' }
                        ]
                    });
                }

                hideModal('create-table-modal');
                showToast('Review table created', 'success');
                loadReviewTables();
                loadDashboardStats();
            } catch (e) {
                showToast('Failed to create table', 'error');
            }
        }

        function createFromTemplate(templateId) {
            document.getElementById('table-template').value = templateId;
            document.getElementById('table-name').value = '';
            showCreateTableModal();
        }

        async function deleteTable(tableId) {
            if (!confirm('Are you sure you want to delete this review table?')) return;
            
            try {
                await API.tables.delete(tableId);
                showToast('Table deleted', 'success');
                loadReviewTables();
            } catch (e) {
                showToast('Failed to delete table', 'error');
            }
        }

        async function exportTable(tableId) {
            try {
                const result = await API.tables.exportCsv(tableId);
                if (result.csv) {
                    const blob = new Blob([result.csv], { type: 'text/csv' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = result.filename || 'export.csv';
                    a.click();
                    URL.revokeObjectURL(url);
                    showToast('Table exported', 'success');
                }
            } catch (e) {
                showToast('Failed to export table', 'error');
            }
        }

        // =========================================================================
        // Shared Spaces
        // =========================================================================
        async function loadSharedSpaces() {
            const container = document.getElementById('spaces-list');
            container.innerHTML = '<div class="loading"><div class="spinner"></div> Loading spaces...</div>';

            try {
                const result = await API.spaces.list();
                STATE.sharedSpaces = result.spaces || [];
                
                if (STATE.sharedSpaces.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="icon"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg></div>
                            <h3>No shared spaces</h3>
                            <p>Create a space to collaborate with clients and team members</p>
                            <button class="btn btn-primary" onclick="showCreateSpaceModal()">Create Space</button>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = STATE.sharedSpaces.map(s => `
                    <div class="doc-item">
                        <div class="doc-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg></div>
                        <div class="doc-info">
                            <h4>${s.name}</h4>
                            <span class="meta">${s.member_count || 1} members â€¢ ${s.visibility}</span>
                        </div>
                        <div class="doc-actions">
                            <span class="badge ${s.visibility === 'private' ? 'badge-neutral' : 'badge-info'}">${s.visibility}</span>
                            <button class="btn btn-danger btn-sm" onclick="deleteSpace('${s.id}')">Delete</button>
                        </div>
                    </div>
                `).join('');

                updateStat('stat-spaces', STATE.sharedSpaces.length);
            } catch (e) {
                container.innerHTML = '<div class="empty-state"><h3>Failed to load spaces</h3></div>';
            }
        }

        async function createSharedSpace() {
            const name = document.getElementById('space-name').value.trim();
            const description = document.getElementById('space-description').value.trim();
            const visibility = document.getElementById('space-visibility').value;

            if (!name) {
                showToast('Please enter a space name', 'warning');
                return;
            }

            try {
                await API.spaces.create({ name, description, visibility });
                hideModal('create-space-modal');
                showToast('Shared space created', 'success');
                loadSharedSpaces();
                loadDashboardStats();
            } catch (e) {
                showToast('Failed to create space', 'error');
            }
        }

        async function deleteSpace(spaceId) {
            if (!confirm('Are you sure you want to delete this shared space?')) return;
            
            try {
                await API.spaces.delete(spaceId);
                showToast('Space deleted', 'success');
                loadSharedSpaces();
                loadDashboardStats();
            } catch (e) {
                showToast('Failed to delete space', 'error');
            }
        }

        // =========================================================================
        // Workflows
        // =========================================================================
        function loadWorkflows() {
            const container = document.getElementById('workflows-list');
            
            if (STATE.workflows.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg></div>
                        <h3>No active workflows</h3>
                        <p>Start a workflow to automate legal tasks</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = STATE.workflows.map(w => `
                <div class="doc-item">
                    <div class="doc-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg></div>
                    <div class="doc-info">
                        <h4>${w.name}</h4>
                        <span class="meta">Started ${formatDate(w.started_at)}</span>
                    </div>
                    <span class="badge ${w.status === 'completed' ? 'badge-success' : 'badge-warning'}">${w.status}</span>
                </div>
            `).join('');

            updateStat('stat-workflows', STATE.workflows.filter(w => w.status !== 'completed').length);
        }

        function startWorkflow(workflowId) {
            STATE.currentWorkflow = workflowId;
            const modal = document.getElementById('workflow-modal');
            const title = document.getElementById('workflow-modal-title');
            const body = document.getElementById('workflow-modal-body');
            
            const workflows = {
                translation: {
                    title: 'Document Translation',
                    body: `
                        <div class="form-group">
                            <label>Select Document</label>
                            <select id="workflow-doc" style="width: 100%;">
                                <option value="">-- Select a document --</option>
                                ${STATE.documents.map(d => `<option value="${d.id}">${d.filename}</option>`).join('')}
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Or paste text</label>
                            <textarea id="workflow-text" rows="4" placeholder="Paste legal text to translate..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Target Audience</label>
                            <select id="workflow-target">
                                <option value="client">Client (Plain English)</option>
                                <option value="expert">Expert (Technical)</option>
                                <option value="layperson">General Public</option>
                            </select>
                        </div>
                    `
                },
                redline: {
                    title: 'Redline Comparison',
                    body: `
                        <div class="form-group">
                            <label>Document 1 (Original)</label>
                            <select id="workflow-doc1" style="width: 100%;">
                                <option value="">-- Select document --</option>
                                ${STATE.documents.map(d => `<option value="${d.id}">${d.filename}</option>`).join('')}
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Document 2 (Revised)</label>
                            <select id="workflow-doc2" style="width: 100%;">
                                <option value="">-- Select document --</option>
                                ${STATE.documents.map(d => `<option value="${d.id}">${d.filename}</option>`).join('')}
                            </select>
                        </div>
                    `
                },
                due_diligence: {
                    title: 'Due Diligence Review',
                    body: `
                        <div class="form-group">
                            <label>Select Documents for Review</label>
                            <div id="workflow-docs-list" style="max-height: 200px; overflow-y: auto; border: 1px solid var(--border); border-radius: 8px; padding: 8px;">
                                ${STATE.documents.map(d => `
                                    <label style="display: flex; align-items: center; gap: 8px; padding: 8px; cursor: pointer;">
                                        <input type="checkbox" value="${d.id}" class="workflow-doc-check">
                                        <span>${d.filename}</span>
                                    </label>
                                `).join('')}
                            </div>
                        </div>
                    `
                },
                proofreading: {
                    title: 'Multi-Pass Proofreading',
                    body: `
                        <div class="form-group">
                            <label>Select Document</label>
                            <select id="workflow-doc" style="width: 100%;">
                                <option value="">-- Select a document --</option>
                                ${STATE.documents.map(d => `<option value="${d.id}">${d.filename}</option>`).join('')}
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Or paste text</label>
                            <textarea id="workflow-text" rows="6" placeholder="Paste document text to proofread..."></textarea>
                        </div>
                    `
                }
            };

            const config = workflows[workflowId];
            if (config) {
                title.textContent = config.title;
                body.innerHTML = config.body;
                showModal('workflow-modal');
            }
        }

        async function executeWorkflow() {
            const workflowId = STATE.currentWorkflow;
            
            try {
                let result;
                
                switch (workflowId) {
                    case 'translation': {
                        const docId = document.getElementById('workflow-doc')?.value;
                        let text = document.getElementById('workflow-text')?.value?.trim();
                        const target = document.getElementById('workflow-target')?.value || 'client';
                        
                        if (docId && !text) {
                            const doc = await API.vault.get(docId);
                            text = doc.extracted_text;
                        }
                        
                        if (!text) {
                            showToast('Please select a document or paste text', 'warning');
                            return;
                        }
                        
                        result = await API.workflows.translate(text, target);
                        break;
                    }
                    case 'redline': {
                        const doc1 = document.getElementById('workflow-doc1')?.value;
                        const doc2 = document.getElementById('workflow-doc2')?.value;
                        
                        if (!doc1 || !doc2) {
                            showToast('Please select both documents', 'warning');
                            return;
                        }
                        
                        result = await API.workflows.redline(doc1, doc2);
                        break;
                    }
                    case 'due_diligence': {
                        const checks = document.querySelectorAll('.workflow-doc-check:checked');
                        const docIds = Array.from(checks).map(c => c.value);
                        
                        if (docIds.length === 0) {
                            showToast('Please select at least one document', 'warning');
                            return;
                        }
                        
                        result = await API.workflows.dueDiligence(docIds);
                        break;
                    }
                }

                // Add to workflows list
                STATE.workflows.push({
                    id: Date.now().toString(),
                    type: workflowId,
                    name: workflowId.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase()),
                    started_at: new Date().toISOString(),
                    status: 'completed',
                    result
                });

                hideModal('workflow-modal');
                showToast('Workflow completed', 'success');
                loadWorkflows();
                loadDashboardStats();
            } catch (e) {
                showToast('Workflow failed: ' + e.message, 'error');
            }
        }

        // =========================================================================
        // Dashboard Stats & Recent Docs
        // =========================================================================
        function updateStat(id, value) {
            const el = document.getElementById(id);
            if (el) el.textContent = value;
        }

        async function loadDashboardStats() {
            try {
                const [docs, tables, spaces] = await Promise.all([
                    API.vault.list({ limit: 1 }),
                    API.tables.list().catch(() => ({ tables: [] })),
                    API.spaces.list().catch(() => ({ spaces: [] }))
                ]);

                updateStat('stat-docs', docs.count || docs.documents?.length || 0);
                updateStat('stat-contracts', STATE.contracts.length);
                updateStat('stat-workflows', STATE.workflows.filter(w => w.status !== 'completed').length);
                updateStat('stat-spaces', spaces.spaces?.length || 0);
            } catch (e) {
                console.error('Failed to load stats:', e);
            }
        }

        async function loadRecentDocuments() {
            const container = document.getElementById('recent-docs');
            
            try {
                const result = await API.vault.list({ limit: 5 });
                const docs = result.documents || [];
                STATE.documents = docs;
                
                if (docs.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="icon"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="2" y="4" width="20" height="16" rx="2"/><line x1="2" y1="10" x2="22" y2="10"/><circle cx="12" cy="15" r="2"/></svg></div>
                            <h3>No documents yet</h3>
                            <p>Upload your first document to get started</p>
                            <button class="btn btn-primary" onclick="showUploadModal()">Upload Document</button>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = docs.map(doc => `
                    <div class="doc-item" onclick="viewDocument('${doc.id}')" style="cursor: pointer;">
                        <div class="doc-icon">${getFileIcon(doc.filename)}</div>
                        <div class="doc-info">
                            <h4>${doc.filename || doc.original_filename}</h4>
                            <span class="meta">${formatFileSize(doc.file_size)} â€¢ ${formatDate(doc.created_at)}</span>
                        </div>
                    </div>
                `).join('');
            } catch (e) {
                container.innerHTML = '<div class="empty-state"><h3>Failed to load documents</h3></div>';
            }
        }

        // =========================================================================
        // Settings
        // =========================================================================
        function initSettings() {
            // Theme
            const themeSelect = document.getElementById('theme-select');
            themeSelect.value = localStorage.getItem('cami-theme') || 'light';
            themeSelect.addEventListener('change', () => {
                const theme = themeSelect.value;
                if (theme === 'dark') {
                    document.documentElement.setAttribute('data-theme', 'dark');
                } else {
                    document.documentElement.removeAttribute('data-theme');
                }
                localStorage.setItem('cami-theme', theme);
            });

            // Business name
            const businessName = document.getElementById('setting-business-name');
            businessName.value = localStorage.getItem('cami-business-name') || '';
            businessName.addEventListener('change', () => {
                localStorage.setItem('cami-business-name', businessName.value);
            });

            // API Key display
            const apiKey = document.getElementById('setting-api-key');
            apiKey.value = CONFIG.apiKey ? CONFIG.apiKey.slice(0, 8) + '...' : 'Not configured';
        }

        // Save settings button
        document.querySelector('#page-settings .btn-primary')?.addEventListener('click', () => {
            showToast('Settings saved', 'success');
        });

        // =========================================================================
        // Integrations
        // =========================================================================
        const INTEGRATIONS = {
            connected: JSON.parse(localStorage.getItem('cami-integrations') || '{}')
        };

        function connectIntegration(integrationId) {
            const card = document.getElementById(`int-${integrationId}`);
            const btn = card?.querySelector('button');
            
            if (INTEGRATIONS.connected[integrationId]) {
                // Disconnect
                delete INTEGRATIONS.connected[integrationId];
                localStorage.setItem('cami-integrations', JSON.stringify(INTEGRATIONS.connected));
                btn.textContent = 'Connect';
                btn.classList.remove('btn-danger');
                btn.classList.add('btn-secondary');
                showToast(`${integrationId} disconnected`, 'info');
            } else {
                // Simulate OAuth flow - in production this would redirect to OAuth
                const names = {
                    clio: 'Clio',
                    mycase: 'MyCase',
                    practicepanther: 'PracticePanther',
                    dropbox: 'Dropbox',
                    gdrive: 'Google Drive',
                    onedrive: 'OneDrive',
                    docusign: 'DocuSign'
                };
                
                if (confirm(`Connect to ${names[integrationId] || integrationId}?\n\nIn production, this would redirect you to authorize the connection.`)) {
                    INTEGRATIONS.connected[integrationId] = {
                        connected_at: new Date().toISOString(),
                        status: 'active'
                    };
                    localStorage.setItem('cami-integrations', JSON.stringify(INTEGRATIONS.connected));
                    btn.textContent = 'Disconnect';
                    btn.classList.remove('btn-secondary');
                    btn.classList.add('btn-danger');
                    showToast(`${names[integrationId]} connected successfully`, 'success');
                }
            }
        }

        function loadIntegrationStatus() {
            Object.keys(INTEGRATIONS.connected).forEach(id => {
                const card = document.getElementById(`int-${id}`);
                const btn = card?.querySelector('button');
                if (btn) {
                    btn.textContent = 'Disconnect';
                    btn.classList.remove('btn-secondary');
                    btn.classList.add('btn-danger');
                }
            });
        }

        // =========================================================================
        // Utilities
        // =========================================================================
        function getFileIcon(filename) {
            const ext = (filename || '').split('.').pop()?.toLowerCase();
            const icons = {
                pdf: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>',
                doc: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>',
                docx: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>',
                txt: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/></svg>'
            };
            return icons[ext] || icons.txt;
        }

        function formatFileSize(bytes) {
            if (!bytes) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        function formatDate(dateStr) {
            if (!dateStr) return '-';
            try {
                const d = new Date(dateStr);
                return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
            } catch {
                return dateStr;
            }
        }

        // =========================================================================
        // Initialize
        // =========================================================================
        document.addEventListener('DOMContentLoaded', () => {
            // Setup file drops
            setupFileDrop('file-drop', 'file-input');
            setupFileDrop('modal-file-drop', 'modal-file-input');

            // Load initial data
            loadDashboardStats();
            loadRecentDocuments();
            loadContracts();
            loadWorkflows();
            initSettings();
            loadIntegrationStatus();

            // Pre-load documents list for workflows
            API.vault.list({ limit: 100 }).then(r => {
                STATE.documents = r.documents || [];
            }).catch(() => {});
        });
    </script>
</body>
</html>
