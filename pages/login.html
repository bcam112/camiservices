<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign In — Cami</title>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg: #f5f1eb; --card: #ffffff; --border: #d4e0d6;
            --text: #2c2620; --muted: #5c5349; --accent: #5a7d64; --accent-hover: #4a6b54;
            --error: #c0392b; --error-bg: #fdf2f2;
        }
        [data-theme="dark"] {
            --bg: #0f1117; --card: #161822; --border: rgba(90,125,100,0.2);
            --text: #e4e4e8; --muted: #9a9ba4; --accent: #5a7d64; --accent-hover: #6e9a7a;
            --error: #e74c3c; --error-bg: rgba(192,57,43,0.12);
        }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; -webkit-font-smoothing: antialiased; }
        .auth-container { width: 100%; max-width: 400px; padding: 0 24px; }
        .auth-logo { text-align: center; margin-bottom: 40px; }
        .auth-logo h1 { font-family: 'Libre Baskerville', Georgia, serif; font-size: 28px; font-weight: 700; color: var(--text); letter-spacing: -0.02em; }
        .auth-logo p { font-size: 13px; color: var(--muted); margin-top: 6px; letter-spacing: 0.04em; text-transform: uppercase; font-weight: 500; }
        .auth-card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 32px; box-shadow: 0 1px 3px rgba(0,0,0,0.04); }
        .auth-card h2 { font-size: 18px; font-weight: 600; margin-bottom: 24px; text-align: center; }
        .auth-tabs { display: flex; gap: 0; margin-bottom: 24px; border: 1px solid var(--border); border-radius: 8px; overflow: hidden; }
        .auth-tab { flex: 1; padding: 10px; text-align: center; font-size: 13px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.06em; background: transparent; border: none; color: var(--muted); cursor: pointer; transition: all 0.2s; }
        .auth-tab.active { background: var(--accent); color: #fff; }
        .auth-tab:not(.active):hover { background: rgba(90,125,100,0.08); }
        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.08em; color: var(--muted); margin-bottom: 6px; }
        .form-group input { width: 100%; padding: 12px 14px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px; color: var(--text); background: var(--card); transition: border-color 0.2s; outline: none; }
        .form-group input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(90,125,100,0.1); }
        .auth-btn { width: 100%; padding: 12px; margin-top: 8px; background: var(--accent); color: #fff; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: background 0.2s; }
        .auth-btn:hover { background: var(--accent-hover); }
        .auth-btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .auth-error { display: none; padding: 10px 14px; margin-bottom: 16px; background: var(--error-bg); border: 1px solid rgba(192,57,43,0.2); border-radius: 8px; font-size: 13px; color: var(--error); }
        .auth-info { display: none; padding: 10px 14px; margin-bottom: 16px; background: rgba(90,125,100,0.08); border: 1px solid rgba(90,125,100,0.2); border-radius: 8px; font-size: 13px; color: var(--accent); }
        .auth-footer { text-align: center; margin-top: 24px; font-size: 13px; color: var(--muted); }
        .auth-footer a { color: var(--accent); text-decoration: none; font-weight: 500; }
        .auth-footer a:hover { text-decoration: underline; }
        .auth-divider { display: flex; align-items: center; gap: 12px; margin: 20px 0; font-size: 12px; color: var(--muted); text-transform: uppercase; letter-spacing: 0.08em; }
        .auth-divider::before, .auth-divider::after { content: ''; flex: 1; height: 1px; background: var(--border); }
        /* Theme toggle */
        .theme-toggle { position: fixed; bottom: 24px; right: 24px; z-index: 9999; width: 44px; height: 44px; border-radius: 50%; border: 1px solid var(--border); background: var(--text); color: var(--card); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 20px; box-shadow: 0 2px 12px rgba(0,0,0,0.08); transition: background 0.3s, transform 0.15s; }
        .theme-toggle:hover { transform: scale(1.1); background: var(--accent); color: #fff; border-color: var(--accent); }
        .theme-toggle svg { display: none !important; }
        [data-theme="dark"] .theme-toggle { background: var(--card); color: var(--text); }
    </style>
    <script>/* Theme init — prevent flash */
    (function(){try{var t=localStorage.getItem('cami-theme');if(t==='dark')document.documentElement.setAttribute('data-theme','dark');}catch(_){}})();
    </script>
    <link rel="stylesheet" href="/static/synth-anim.css">
</head>
<body>
    <div class="auth-container">
        <div class="auth-logo">
            <h1>Cami</h1>
            <p>Feel the difference</p>
        </div>
        <div class="auth-card">
            <div class="auth-tabs">
                <button class="auth-tab active" id="tab-signin" type="button">Sign In</button>
                <button class="auth-tab" id="tab-signup" type="button">Sign Up</button>
            </div>
            <div id="auth-error" class="auth-error"></div>
            <div id="auth-info" class="auth-info"></div>
            <form id="auth-form" autocomplete="on">
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" name="email" placeholder="you@example.com" autocomplete="email" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" placeholder="Enter your password" autocomplete="current-password" required minlength="6">
                </div>
                <button type="submit" class="auth-btn" id="auth-submit">Sign In</button>
            </form>
        </div>
        <div class="auth-footer">
            <a href="/">Back to Cami</a> &middot; <a href="/try">Try Cami free</a>
        </div>
    </div>

    <script src="/static/js/supabase.min.js"></script>
    <script>
    if (typeof window.supabase === 'undefined') {
        var s = document.createElement('script');
        s.src = 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2';
        s.crossOrigin = 'anonymous';
        document.head.appendChild(s);
    }
    </script>
    <script>
    (function() {
        let sb = null;
        let isSignUp = false;

        function waitSB(cb, n) {
            n = n || 0;
            if (typeof window.supabase !== 'undefined') return cb();
            if (n > 50) return cb();
            setTimeout(() => waitSB(cb, n + 1), 100);
        }

        async function getConfig() {
            try {
                const r = await fetch('/api/config');
                return await r.json();
            } catch { return {}; }
        }

        function showError(msg) {
            const el = document.getElementById('auth-error');
            el.textContent = msg; el.style.display = msg ? 'block' : 'none';
            document.getElementById('auth-info').style.display = 'none';
        }
        function showInfo(msg) {
            const el = document.getElementById('auth-info');
            el.textContent = msg; el.style.display = msg ? 'block' : 'none';
            document.getElementById('auth-error').style.display = 'none';
        }

        // Tab switching
        document.getElementById('tab-signin').addEventListener('click', () => {
            isSignUp = false;
            document.getElementById('tab-signin').classList.add('active');
            document.getElementById('tab-signup').classList.remove('active');
            document.getElementById('auth-submit').textContent = 'Sign In';
            document.getElementById('password').autocomplete = 'current-password';
            showError(''); showInfo('');
        });
        document.getElementById('tab-signup').addEventListener('click', () => {
            isSignUp = true;
            document.getElementById('tab-signup').classList.add('active');
            document.getElementById('tab-signin').classList.remove('active');
            document.getElementById('auth-submit').textContent = 'Create Account';
            document.getElementById('password').autocomplete = 'new-password';
            showError(''); showInfo('');
        });

        document.getElementById('auth-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!sb) { showError('Authentication not ready. Refresh and try again.'); return; }
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;
            if (!email || !password) { showError('Email and password required.'); return; }
            if (password.length < 6) { showError('Password must be at least 6 characters.'); return; }

            const btn = document.getElementById('auth-submit');
            btn.disabled = true;
            btn.textContent = isSignUp ? 'Creating...' : 'Signing in...';
            showError('');

            try {
                if (isSignUp) {
                    const { data, error } = await sb.auth.signUp({ email, password });
                    if (error) { showError(error.message); btn.disabled = false; btn.textContent = 'Create Account'; return; }
                    if (data.session) {
                        window.location.href = '/app';
                    } else {
                        showInfo('Check your email to confirm your account, then sign in.');
                        btn.disabled = false; btn.textContent = 'Create Account';
                    }
                } else {
                    const { data, error } = await sb.auth.signInWithPassword({ email, password });
                    if (error) { showError(error.message); btn.disabled = false; btn.textContent = 'Sign In'; return; }
                    if (data.session) {
                        // Check for redirect param
                        const params = new URLSearchParams(window.location.search);
                        const redirect = params.get('redirect') || '/app';
                        window.location.href = redirect;
                    }
                }
            } catch (err) {
                showError('Something went wrong. Try again.');
                btn.disabled = false;
                btn.textContent = isSignUp ? 'Create Account' : 'Sign In';
            }
        });

        // Init
        waitSB(async () => {
            if (typeof window.supabase === 'undefined') {
                showError('Could not load authentication. Try refreshing.');
                return;
            }
            const config = await getConfig();
            if (!config.supabase_url || !config.supabase_anon_key) {
                showError('Authentication not configured. Contact support.');
                return;
            }
            sb = window.supabase.createClient(config.supabase_url, config.supabase_anon_key);
            // Already logged in? Redirect.
            const { data: { session } } = await sb.auth.getSession();
            if (session) {
                const params = new URLSearchParams(window.location.search);
                window.location.href = params.get('redirect') || '/app';
            }
        });
    })();
    </script>
    <script src="/static/synth-anim.js"></script>
    <script src="/static/theme-toggle.js"></script>
</body>
</html>
